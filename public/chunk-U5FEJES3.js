import{a as We,b as oe,c as $e,d as Qe,g as Je,h as Ye,i as Ke,j as Xe,k as Ze,l as et,m as tt,n as it}from"./chunk-AFGXNRWW.js";import{a as Ne,b as Me}from"./chunk-GIEJIHJL.js";import{b as Oe}from"./chunk-6SSC7OSL.js";import{b as He}from"./chunk-75SDOYVN.js";import{b as Be,c as je,d as ze,e as Ge,f as ie,g as ne}from"./chunk-M4TK2CXA.js";import{a as Ie,b as Pe}from"./chunk-5T2WG2T2.js";import"./chunk-NUJVDWER.js";import"./chunk-GAUTFBLU.js";import{a as Ue}from"./chunk-T7MFMHRL.js";import{d as B,e as j,f as Se,g as be,h as Te,i as Fe,j as we,m as ke}from"./chunk-Y7MSNO74.js";import{b as qe,c as X,d as Le,e as Z}from"./chunk-2NLAH6WF.js";import{f as ee,g as te}from"./chunk-7ADWQQCS.js";import"./chunk-3B5E5M2C.js";import"./chunk-KDDLKMGZ.js";import{$a as U,E as he,ab as O,gb as ye,hb as k,jb as z,kb as G,nb as H,pb as W,qb as $,r as ve,rb as Q,sb as Ee,t as L,tb as J,ub as Ae,vb as Y,wb as De,xb as K,yb as Ve,zb as Re}from"./chunk-XYURQZTM.js";import{$b as _e,Ab as A,Cb as b,Db as I,Fb as P,Gb as q,Hb as i,Hc as xe,Ib as r,Jb as _,Nb as x,Rb as f,S as de,Sb as d,Wa as l,_b as fe,a as y,ac as w,b as ae,ba as h,bc as p,c as le,cb as ce,cc as F,dc as E,f as se,fc as D,gc as V,hc as R,ia as c,ja as u,jc as S,kb as M,qb as C,s as pe,tc as ge,vc as Ce,w as me,wc as v,xa as g,xb as m,yb as ue}from"./chunk-LW3WOUBG.js";var ut=()=>({severity:"secondary"}),ft=()=>({"min-width":"75rem"}),_t=()=>["documentNumber","firstName","paternalLastName","maternalLastName"],gt=()=>({width:"40rem"}),Ct=()=>({"1199px":"75vw","575px":"90vw"});function xt(t,n){if(t&1&&(i(0,"div",26),_(1,"i",29),i(2,"span",30),p(3),r()()),t&2){let e=d(2);l(3),F(e.selectedFileName())}}function vt(t,n){t&1&&(i(0,"span"),p(1,"Nota de solicitud dirigida a ASFI - (PDF)"),r())}function ht(t,n){if(t&1){let e=x();i(0,"form",15)(1,"div",16)(2,"div",17)(3,"p-floatlabel"),_(4,"input",18),i(5,"label"),p(6,"Nombre Autoridad Solicitante"),r()()(),i(7,"div",17)(8,"p-floatlabel"),_(9,"input",19),i(10,"label"),p(11,"Cargo Autoridad Solicitante"),r()()(),i(12,"div",20)(13,"p-floatlabel"),_(14,"input",21),i(15,"label"),p(16,"Codigo Solicitud (CITE)"),r()()(),i(17,"div")(18,"p-floatlabel"),_(19,"input",22),i(20,"label"),p(21,"Gerencia Solicitante"),r()()(),i(22,"div",23)(23,"div",24)(24,"p-fileupload",25),f("onSelect",function(a){c(e);let s=d();return u(s.onFileSelect(a))}),r(),i(25,"div"),C(26,xt,4,1,"div",26)(27,vt,2,0,"span"),r()()()()(),i(28,"div",27)(29,"p-button",28),f("onClick",function(){let a=c(e).activateCallback;return u(a(2))}),r()()}if(t&2){let e=d();m("formGroup",e.form),l(24),m("auto",!0),l(2),b(e.selectedFileName()?26:27)}}function St(t,n){if(t&1){let e=x();i(0,"p-button",36),f("onClick",function(){c(e);let a=d(2);return u(a.datasource.set([]))}),r()}if(t&2){let e=d(2);m("disabled",e.datasource().length===0)}}function bt(t,n){if(t&1){let e=x();i(0,"div",37)(1,"a",38),_(2,"i",39),r(),i(3,"p-fileUpload",40),f("onSelect",function(a){c(e);let s=d(2);return u(s.loadExcel(a))}),r()()}t&2&&(l(3),m("chooseButtonProps",S(1,ut)))}function Tt(t,n){if(t&1){let e=x();i(0,"div",41)(1,"p-iconField",42)(2,"p-inputIcon"),_(3,"i",43),r(),i(4,"input",44),f("input",function(a){c(e),d();let s=w(1),T=d(2);return u(T.onGlobalFilterTable(s,a))}),r()()()}}function Ft(t,n){if(t&1&&(i(0,"th")(1,"div",46),p(2),r()()),t&2){let e,o=n.$implicit;ue("min-width",(e=o.width)!==null&&e!==void 0?e:"15rem"),l(2),F(o.header)}}function wt(t,n){if(t&1&&(i(0,"tr"),P(1,Ft,3,3,"th",45,I),r()),t&2){let e=d(3);l(),q(e.COLUMNS)}}function yt(t,n){if(t&1&&(i(0,"td"),p(1),r()),t&2){let e=n.$implicit,o=d().$implicit;l(),F(o[e.columnDef])}}function Et(t,n){if(t&1&&(i(0,"tr"),P(1,yt,2,1,"td",null,I),r()),t&2){let e=d(3);l(),q(e.COLUMNS)}}function At(t,n){if(t&1&&(i(0,"tr")(1,"td",47),p(2,"Sin registros"),r()()),t&2){let e=d(3);l(),m("colSpan",e.COLUMNS.length)}}function Dt(t,n){if(t&1&&(i(0,"p-table",32,3),C(2,Tt,5,0,"ng-template",null,4,v)(4,wt,3,0,"ng-template",null,5,v)(6,Et,3,0,"ng-template",null,6,v)(8,At,3,1,"ng-template",null,7,v),r()),t&2){let e=d(2);m("value",e.datasource())("rows",10)("paginator",!0)("showCurrentPageReport",!0)("tableStyle",S(7,ft))("alwaysShowPaginator",e.datasource().length>5)("globalFilterFields",S(8,_t))}}function Vt(t,n){t&1&&(i(0,"div",33),p(1," No hay personas registradas en la solicitud "),r())}function Rt(t,n){if(t&1){let e=x();i(0,"p-toolbar",31),C(1,St,1,1,"ng-template",null,1,v)(3,bt,4,2,"ng-template",null,2,v),r(),C(5,Dt,10,9,"p-table",32)(6,Vt,2,0,"div",33),i(7,"div",34)(8,"p-button",35),f("onClick",function(){let a=c(e).activateCallback;return u(a(1))}),r(),i(9,"p-button",28),f("onClick",function(){let a=c(e).activateCallback;return u(a(3))}),r()()}if(t&2){let e=d();l(5),b(e.datasource().length>0?5:6)}}function kt(t,n){if(t&1&&(i(0,"div",50)(1,"dl",51)(2,"div",52)(3,"dt",53),p(4,"Tipo de solicitud"),r(),i(5,"dd",54),p(6," Solicitud de Retencion de Fondos "),r()(),i(7,"div",52)(8,"dt",53),p(9,"Codigo solicitud (CITE)"),r(),i(10,"dd",54),p(11),r()(),i(12,"div",52)(13,"dt",53),p(14,"Circular"),r(),i(15,"dd",54),p(16),r()(),i(17,"div",52)(18,"dt",53),p(19,"Numero de elementos"),r(),i(20,"dd",54),p(21),r()()()()),t&2){let e,o,a,s=d(2);l(11),E(" ",(e=s.selectedAsfiRequest())==null?null:e.requestCode," "),l(5),E(" ",(o=s.selectedAsfiRequest())==null?null:o.circularNumber," "),l(5),E(" ",(a=s.selectedAsfiRequest())==null?null:a.quantityDetail," ")}}function Nt(t,n){t&1&&(i(0,"div",33),p(1," Seleccione una solicitud de retencion (Numero de circular) "),r())}function Mt(t,n){if(t&1){let e=x();i(0,"div",48)(1,"p-select",49,8),f("onFilter",function(a){c(e);let s=d();return u(s.searchAprovedCodes(a.filter))})("onChange",function(a){c(e);let s=w(2),T=d();return u(T.onSelectAsfiRequest(a.value,s))}),r(),C(3,kt,22,3,"div",50)(4,Nt,2,0,"div",33),r(),i(5,"div",34)(6,"p-button",35),f("onClick",function(){let a=c(e).activateCallback;return u(a(2))}),r()()}if(t&2){let e=d();l(),m("filter",!0)("options",e.aprovedRequests()),l(2),b(e.selectedAsfiRequest()?3:4)}}function It(t,n){if(t&1&&(i(0,"p"),p(1),r()),t&2){let e=n.$implicit;l(),F(e)}}function Pt(t,n){if(t&1){let e=x();i(0,"p-dialog",55),R("visibleChange",function(a){c(e);let s=d();return V(s.isErrorDialogShowing,a)||(s.isErrorDialogShowing=a),u(a)}),P(1,It,2,1,"p",null,I),r()}if(t&2){let e=d();A(S(6,gt)),m("modal",!0)("draggable",!1),D("visible",e.isErrorDialogShowing),m("breakpoints",S(7,Ct)),l(),q(e.errorMessages())}}var N=class t{formBuilder=h(Q);dialogRef=h(be);excelService=h(qe);messageService=h(we);fileUploadService=h(Z);requestService=h(X);asfiRequestService=h(Le);COLUMNS=[{header:"Item",columnDef:"item",width:"40px"},{header:"Nombres",columnDef:"firstName",width:"15rem"},{header:"Apellido Paterno",columnDef:"paternalLastName"},{header:"Apellido Materno",columnDef:"maternalLastName"},{header:"Tipo Documento",columnDef:"documentType"},{header:"Numero Documento",columnDef:"documentNumber"},{header:"Complemento",columnDef:"complement"},{header:"Extension",columnDef:"extension",width:"100px"},{header:"Documento Respaldo",columnDef:"supportDocument"},{header:"Razon Social",columnDef:"businessName"},{header:"Monto",columnDef:"amount"},{header:"Tipo Respaldo",columnDef:"supportType"},{header:"Numero Cuenta",columnDef:"accountNumber"},{header:"Cuenta Moneda",columnDef:"accountCurrency"},{header:"Codigo Envio",columnDef:"transferCode"}];data=h(Se).data;datasource=g([]);form=this.formBuilder.group({authorityPosition:["",k.required],requestingAuthority:["",k.required],requestCode:["",k.required],department:["",k.required]});selectedFile=g(null);selectedFileName=g(null);selectedAsfiRequest=g(null);isErrorDialogShowing=g(!1);errorMessages=g([]);aprovedRequests=g([]);constructor(){}ngOnInit(){this.loadFormData()}save(){if(!this.isFormValid)return;this.buildSaveMethod().subscribe({next:e=>{this.dialogRef.close(e)},error:e=>{e instanceof he&&this.handleHtttErrrors(e)}})}onGlobalFilterTable(n,e){n.filterGlobal(e.target.value,"contains")}onFileSelect(n){let[e]=n.files;this.selectedFile.set(e)}close(){this.dialogRef.close()}searchAprovedCodes(n){n&&this.asfiRequestService.searchAprovedCodes(n).pipe(me(e=>e.map(o=>({label:`Nro. CITE: ${o.requestCode} / Circular: ${o.circularNumber}`,value:o})))).subscribe(e=>{this.aprovedRequests.set(e)})}onSelectAsfiRequest(n,e){e.clear(),this.selectedAsfiRequest.set(n)}loadExcel(n){return se(this,null,function*(){let[e]=n.files;if(!e)return;let o=yield this.excelService.readExcelFile(e);this.datasource.set(this.excelDataToDto(o))})}get isFormValid(){return this.data?this.form.valid&&this.datasource().length>0:this.form.valid&&this.datasource().length>0&&this.selectedFile()}excelDataToDto(n){return n.map(e=>({item:e.Item,maternalLastName:e["Apellido Materno"],paternalLastName:e["Apellido Paterno"],complement:e["Tipo Documento"],extension:e.Extension,documentNumber:e["Numero Documento"],documentType:e["Tipo Documento"],supportDocument:e["Documento Respaldo"],amount:e.Monto,firstName:e.Nombres,businessName:e["Razon Social"],supportType:e["Tipo Respaldo"],accountNumber:e["Numero Cuenta"],accountCurrency:e["Cuenta Moneda"],transferCode:e["Codigo Envio"]}))}handleHtttErrrors(n){let{message:e}=n.error;switch(n.status){case 409:let o=n.error.request;this.messageService.message({header:"Error al registrar la solicitud",description:typeof e=="string"?e:"La solicitud es invalida"}),this.dialogRef.close(o);break;case 400:Array.isArray(e)&&(this.errorMessages.set(this.parseValidationErrors(e)),this.isErrorDialogShowing.set(!0));break;default:break}}parseValidationErrors(n){return n.map(e=>{let o=e.split(".",3);if(o.length<=2)return o.join(".");let a=parseInt(o[1],10),s=o.slice(2).join(".");return`Fila ${a+1}: ${s.trim()}`})}loadFormData(){if(!this.data)return;let a=this.data,{asfiRequest:n,file:e}=a,o=le(a,["asfiRequest","file"]);this.form.patchValue(o),this.selectedAsfiRequest.set(n),this.selectedFileName.set(e.originalName)}buildSaveMethod(){let n=this.selectedFile();return(n?this.fileUploadService.uploadAsfiNote(n):pe(null)).pipe(de(o=>{let a=y({form:ae(y({},this.form.value),{asfiRequestId:this.selectedAsfiRequest()?.id}),details:this.datasource()},o&&{file:o});return this.data?this.requestService.update(y({id:this.data.id},a)):this.requestService.create(a.form,a.details,o)}))}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=M({type:t,selectors:[["app-asfi-fund-transfer-dialog"]],decls:23,vars:9,consts:[["content",""],["start",""],["end",""],["dt",""],["caption",""],["header",""],["body",""],["emptymessage",""],["inputSelect",""],[1,"p-dialog-content"],[3,"value"],[1,"p-dialog-footer"],["label","Cancelar","severity","danger","variant","outlined",3,"onClick"],["label","Guardar",3,"onClick","disabled"],["header","Errores Formato",3,"modal","draggable","visible","style","breakpoints"],[3,"formGroup"],[1,"grid","grid-cols-4","gap-y-8","gap-x-4"],[1,"col-span-2"],["pInputText","","formControlName","requestingAuthority",1,"w-full"],["pInputText","","formControlName","authorityPosition",1,"w-full"],[1,"sm:col-span-2"],["pInputText","","formControlName","requestCode",1,"w-full"],["pInputText","","formControlName","department",1,"w-full"],[1,"col-span-4"],[1,"flex","flex-col","sm:flex-row","items-center","gap-4"],["mode","basic","chooseIcon","pi pi-upload","accept",".pdf","chooseLabel","Seleccionar",3,"onSelect","auto"],[1,"px-3","py-2","rounded-md","bg-green-50","ring-1","ring-green-500","text-black"],[1,"flex","py-4","justify-end"],["icon","pi pi-arrow-right","label","Siguiente","iconPos","right","size","small","severity","secondary",3,"onClick"],[1,"pi","pi-file-pdf"],[1,"ml-2"],[1,"p-0","m-0"],["currentPageReportTemplate","{first} - {last} de {totalRecords} Registros","paginatorDropdownAppendTo","body",3,"value","rows","paginator","showCurrentPageReport","tableStyle","alwaysShowPaginator","globalFilterFields"],[1,"px-4","py-6","font-medium","text-lg"],[1,"flex","py-4","justify-between"],["label","Atras","severity","secondary","size","small","icon","pi pi-arrow-left",3,"onClick"],["severity","danger","label","Remover","icon","pi pi-trash","outlined","",3,"onClick","disabled"],[1,"flex","gap-x-2"],["severity","secondary","href","files/formato-cabeceras.xlsx",1,"p-button"],[1,"pi","pi-arrow-down"],["mode","basic","accept",".xlsx,.ods","chooseLabel","Importar","auto","","customUpload","",1,"mr-2","inline-block",3,"onSelect","chooseButtonProps"],[1,"flex","justify-end"],["iconPosition","left"],[1,"pi","pi-search"],["pInputText","","type","text","placeholder","Nombres / Nro. Documento",3,"input"],[3,"min-width"],[1,"flex","items-center"],[3,"colSpan"],[1,"flex","flex-col","gap-y-4"],["appendTo","body","placeholder","Buscar solicitud de retencion","filterPlaceholder","Numero de CITE","emptyFilterMessage","Sin resultados","optionLabel","label","optionValue","value",1,"w-full",3,"onFilter","onChange","filter","options"],[1,"mt-4","px-2"],[1,"divide-y","divide-gray-100"],[1,"px-4","py-2","sm:grid","sm:grid-cols-3","sm:gap-4","sm:px-0"],[1,"text-lg","font-medium"],[1,"mt-1","text-lg","sm:col-span-2","sm:mt-0"],["header","Errores Formato",3,"visibleChange","modal","draggable","visible","breakpoints"]],template:function(e,o){if(e&1){let a=x();i(0,"div",9)(1,"p-stepper",10)(2,"p-step-list")(3,"p-step",10),p(4,"Detalle Solicitud"),r(),i(5,"p-step",10),p(6,"Personas Afectadas"),r(),i(7,"p-step",10),p(8,"Detalle Remision de Fondos "),r()(),i(9,"p-step-panels")(10,"p-step-panel",10),C(11,ht,30,3,"ng-template",null,0,v),r(),i(13,"p-step-panel",10),C(14,Rt,10,1,"ng-template",null,0,v),r(),i(16,"p-step-panel",10),C(17,Mt,7,3,"ng-template",null,0,v),r()()()(),i(19,"div",11)(20,"p-button",12),f("onClick",function(){return c(a),u(o.close())}),r(),i(21,"p-button",13),f("onClick",function(){return c(a),u(o.save())}),r()(),C(22,Pt,3,8,"p-dialog",14)}e&2&&(l(),m("value",1),l(2),m("value",1),l(2),m("value",2),l(2),m("value",3),l(3),m("value",1),l(3),m("value",2),l(3),m("value",3),l(5),m("disabled",!o.isFormValid),l(),b(o.isErrorDialogShowing()?22:-1))},dependencies:[L,Ee,H,ye,z,G,J,W,$,it,tt,Ke,et,Ze,Xe,O,U,ne,ie,Ye,Je,Re,Ve,Ue,te,ee,Y,Ae,K,De,oe,We,j,B,Oe],encapsulation:2,changeDetection:0})};var qt=["op"],Lt=()=>({"min-width":"50rem"}),nt=()=>({width:"50vw"}),ot=()=>({"1199px":"75vw","575px":"90vw"});function Ut(t,n){if(t&1){let e=x();i(0,"div",13)(1,"search-input",26),f("onSearch",function(a){c(e);let s=d();return u(s.search(a))}),r()()}}function Ot(t,n){t&1&&(i(0,"tr"),_(1,"th",27),i(2,"th"),p(3,"Codigo"),r(),i(4,"th"),p(5,"Archivo"),r(),i(6,"th"),p(7,"Circular"),r(),i(8,"th"),p(9,"Creacion"),r(),i(10,"th"),p(11,"Cantidad"),r(),_(12,"th",27),r())}function Bt(t,n){t&1&&_(0,"i",28)}function jt(t,n){t&1&&_(0,"i",29)}function zt(t,n){t&1&&_(0,"i",30)}function Gt(t,n){if(t&1&&p(0),t&2){let e=d().$implicit;E(" ",e.circularNumber," ")}}function Ht(t,n){t&1&&(i(0,"span",32),p(1,"Sin asignar"),r())}function Wt(t,n){if(t&1){let e=x();i(0,"tr")(1,"td"),C(2,Bt,1,0,"i",28)(3,jt,1,0,"i",29)(4,zt,1,0,"i",30),r(),i(5,"td"),p(6),r(),i(7,"td")(8,"p-button",31),f("onClick",function(){let a=c(e).$implicit,s=d();return u(s.showFile(a))}),r()(),i(9,"td"),C(10,Gt,1,1)(11,Ht,2,0,"span",32),r(),i(12,"td"),p(13),ge(14,"date"),r(),i(15,"td"),p(16),r(),i(17,"td")(18,"p-menu",33,5),f("onShow",function(){let a=c(e).$implicit,s=d();return u(s.onShowOptionsMenu(a))}),r(),i(20,"p-button",34),f("onClick",function(a){c(e);let s=w(19);return u(s.toggle(a))}),r()()()}if(t&2){let e,o=n.$implicit,a=d();l(2),b((e=o.status)==="pending"?2:e==="completed"?3:4),l(4),F(o.requestCode),l(4),b(o.circularNumber?10:11),l(3),F(Ce(14,9,o.createdAt,"short")),l(3),F(o.quantityDetail),l(2),m("popup",!0)("model",a.menuOptions()),l(2),m("rounded",!0)("text",!0)}}function $t(t,n){t&1&&(i(0,"tr")(1,"td",35),p(2,"Sin registros"),r()()),t&2&&(l(),m("colSpan",7))}function Qt(t,n){if(t&1){let e=x();i(0,"div",13)(1,"p-paginator",36),f("onPageChange",function(a){c(e);let s=d();return u(s.onPageChange(a))}),r()()}if(t&2){let e=d();l(),m("rows",e.limit())("first",e.offset())("totalRecords",e.datasize())("showCurrentPageReport",!0)("showPageLinks",!1)("showJumpToPageDropdown",!1)}}function Jt(t,n){if(t&1){let e=x();i(0,"p-dialog",37),R("visibleChange",function(a){c(e);let s=d();return V(s.isShowingFile,a)||(s.isShowingFile=a),u(a)}),f("onHide",function(){c(e);let a=d();return u(a.currentFileUrl.set(""))}),i(1,"span",38),p(2,"Archivo adjuntado"),r(),_(3,"pdf-viewer",39),r()}if(t&2){let e=d();A(S(8,nt)),m("modal",!0),D("visible",e.isShowingFile),m("breakpoints",S(9,ot)),l(3),m("src",e.currentFileUrl())("render-text",!1)("original-size",!1)}}function Yt(t,n){if(t&1){let e=x();i(0,"p-dialog",37),R("visibleChange",function(a){c(e);let s=d();return V(s.isShowingFile,a)||(s.isShowingFile=a),u(a)}),f("onHide",function(){c(e);let a=d();return u(a.currentFileUrl.set(""))}),i(1,"span",38),p(2,"Archivo adjuntado"),r(),_(3,"pdf-viewer",39),r()}if(t&2){let e=d();A(S(8,nt)),m("modal",!0),D("visible",e.isShowingFile),m("breakpoints",S(9,ot)),l(3),m("src",e.currentFileUrl())("render-text",!1)("original-size",!1)}}var re=class t{formBuilder=h(Q);dialogService=h(Fe);requestService=h(X);fileService=h(Z);popoverRef=ce.required("op");datasource=g([]);datasize=g(0);limit=g(10);index=g(0);offset=xe(()=>this.limit()*this.index());term=g("");isShowingFile=g(!1);currentFileUrl=g("");menuOptions=g([]);filterForm=this.formBuilder.group({createdAt:[""],processType:[""],status:[""],isAproved:[""]});PROCESS_TYPES=[{value:"R",label:"Retencion"},{value:"S",label:"Suspension"}];STATUS=[{value:"pending",label:"Pendientes"},{value:"completed",label:"Completados"}];STATES=[{value:!0,label:"Con circular"},{value:!1,label:"Sin circular"}];ngOnInit(){this.getData()}onPageChange({rows:n=10,page:e=0}){this.limit.set(n),this.index.set(e),this.getData()}search(n){this.term.set(n),this.index.set(0),this.getData()}create(){this.dialogService.open(N,{header:"Crear Solicitud",maximizable:!0,modal:!0,width:"50vw",breakpoints:{"960px":"75vw","640px":"90vw"}}).onClose.subscribe(e=>{e&&(this.datasource.update(o=>[e,...o].slice(0,this.limit())),this.datasize.update(o=>o+=1))})}update(n){this.dialogService.open(N,{header:"Editar Solicitud",maximizable:!0,modal:!0,width:"50vw",breakpoints:{"960px":"75vw","640px":"90vw"},data:n}).onClose.subscribe(o=>{o&&(this.datasource.update(a=>{let s=a.findIndex(({id:T})=>T===o.id);return s===-1?a:(a[s]=o,[...a])}),this.datasize.update(a=>a+=1))})}showFile(n){this.fileService.getFile(n.file.fileName).subscribe(e=>{let o=new Blob([e],{type:"application/pdf"}),a=URL.createObjectURL(o);this.currentFileUrl.set(a),this.isShowingFile.set(!0)})}onShowOptionsMenu(n){this.menuOptions.set([{label:"Opciones",items:[{icon:"pi pi-pencil",label:"Editar solicitud",disabled:n.status!=="pending",command:()=>{this.update(n)}},{icon:"pi pi-info-circle",label:"Detalle solicitud",command:()=>{}},{icon:"pi pi-building-columns",label:"Solicitar remision de fondos",disabled:!n.circularNumber,command:()=>{}}]}])}filter(){this.index.set(0),this.popoverRef().hide(),this.getData()}resetFilter(){this.filterForm.reset(),this.filter()}closeFileDialog(){URL.revokeObjectURL(this.currentFileUrl()),this.currentFileUrl.set(""),this.isShowingFile.set(!1)}get isFilterFormValid(){return Object.values(this.filterForm.value).some(n=>n!==null)}getData(){this.requestService.findAll(y({limit:this.limit(),offset:this.offset(),term:this.term()},this.filterForm.value)).subscribe(n=>{this.datasource.set(n.requests),this.datasize.set(n.length)})}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=M({type:t,selectors:[["app-asfi-fund-tranfer"]],viewQuery:function(e,o){e&1&&fe(o.popoverRef,qt,5),e&2&&_e()},decls:37,vars:13,consts:[["caption",""],["header",""],["body",""],["emptymessage",""],["op",""],["menu",""],[1,"flex","items-center","justify-between"],[1,"font-medium","text-2xl"],[1,"flex","gap-x-4"],["icon","pi pi-filter",3,"click"],["label","Agregar","icon","pi pi-plus",3,"onClick"],[1,"card","mt-4"],[3,"value","tableStyle"],[1,"flex","justify-end"],["header","Archivo Adjunto",3,"modal","visible","breakpoints","style"],[1,"flex","flex-col","gap-4","w-[25rem]","p-2"],[1,"text-xl"],["icon","pi pi-times",3,"onClick","text"],[3,"formGroup"],[1,"mt-4","flex","flex-col","gap-y-4"],["optionLabel","label","placeholder","Estado del envio","optionValue","value","formControlName","status",1,"w-full",3,"options"],["inputId","icondisplay","styleClass","w-full","placeholder","Fecha creacion","optionValue","value","formControlName","createdAt",1,"w-full",3,"iconDisplay","showIcon"],["optionLabel","label","placeholder","Asignacion circular","optionValue","value","formControlName","isAproved",1,"w-full",3,"options"],[1,"flex","justify-end","gap-x-2","mt-4"],["label","Limpiar","severity","secondary",3,"onClick"],["label","Filtrar",3,"onClick","disabled"],["placeholder","Buscar",3,"onSearch"],[2,"width","4rem"],[1,"pi","pi-exclamation-triangle",2,"color","orange"],[1,"pi","pi-verified",2,"color","green"],[1,"pi","pi-question-circle"],["icon","pi pi-file-pdf","severity","secondary","label","Adjunto","size","small",1,"truncate",3,"onClick"],[1,"text-red-500"],["appendTo","body",3,"onShow","popup","model"],["icon","pi pi-ellipsis-v","size","small",3,"onClick","rounded","text"],[3,"colSpan"],["currentPageReportTemplate","{first} - {last} de {totalRecords} Registros",3,"onPageChange","rows","first","totalRecords","showCurrentPageReport","showPageLinks","showJumpToPageDropdown"],["header","Archivo Adjunto",3,"visibleChange","onHide","modal","visible","breakpoints"],[1,"p-text-secondary","block","mb-8"],[2,"width","100%","height","500px",3,"src","render-text","original-size"]],template:function(e,o){if(e&1){let a=x();i(0,"div",6)(1,"span",7),p(2,"Remisiones de Fondos"),r(),i(3,"div",8)(4,"p-button",9),f("click",function(T){c(a);let rt=w(20);return u(rt.toggle(T))}),r(),i(5,"p-button",10),f("onClick",function(){return c(a),u(o.create())}),r()()(),i(6,"div",11)(7,"p-table",12),C(8,Ut,2,0,"ng-template",null,0,v)(10,Ot,13,0,"ng-template",null,1,v)(12,Wt,21,12,"ng-template",null,2,v)(14,$t,3,1,"ng-template",null,3,v),r(),C(16,Qt,2,6,"div",13),r(),C(17,Jt,4,10,"p-dialog",14)(18,Yt,4,10,"p-dialog",14),i(19,"p-popover",null,4)(21,"div",15)(22,"div",6)(23,"div",16),p(24,"Filtro avanzado"),r(),i(25,"p-button",17),f("onClick",function(){c(a);let T=w(20);return u(T.hide())}),r()(),i(26,"form",18)(27,"div",19)(28,"div"),_(29,"p-select",20),r(),i(30,"div"),_(31,"p-datepicker",21),r(),i(32,"div"),_(33,"p-select",22),r()()(),i(34,"div",23)(35,"p-button",24),f("onClick",function(){return c(a),u(o.resetFilter())}),r(),i(36,"p-button",25),f("onClick",function(){return c(a),u(o.filter())}),r()()()()}e&2&&(l(7),m("value",o.datasource())("tableStyle",S(12,Lt)),l(9),b(o.datasize()>o.limit()?16:-1),l(),b(o.isShowingFile()?17:-1),l(),b(o.isShowingFile()?18:-1),l(7),m("text",!0),l(),m("formGroup",o.filterForm),l(3),m("options",o.STATUS),l(2),m("iconDisplay","input")("showIcon",!0),l(2),m("options",o.STATES),l(3),m("disabled",!o.isFilterFormValid))},dependencies:[L,ve,J,H,z,G,W,$,Te,Qe,$e,je,Be,K,Y,oe,j,B,O,U,ne,ie,He,Pe,Ie,Me,Ne,te,ee,Ge,ze,ke],encapsulation:2,changeDetection:0})};export{re as default};
