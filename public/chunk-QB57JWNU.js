import{a as ze,b as le,c as Ge,d as He,e as We,f as $e,g as Ye,h as Qe,i as Je,j as Ke,k as Xe,l as Ze,m as et,n as tt}from"./chunk-AFGXNRWW.js";import{a as Ae,b as Ve}from"./chunk-GIEJIHJL.js";import"./chunk-6SSC7OSL.js";import{b as je}from"./chunk-75SDOYVN.js";import{b as Le,c as Oe,d as Ue,e as Be,f as re,g as ae}from"./chunk-M4TK2CXA.js";import{a as Ie,b as Ne}from"./chunk-5T2WG2T2.js";import"./chunk-NUJVDWER.js";import"./chunk-GAUTFBLU.js";import{a as Pe}from"./chunk-T7MFMHRL.js";import{d as z,e as G,f as H,g as Se,h as be,i as we,j as Re,m as Fe}from"./chunk-Y7MSNO74.js";import{a as ke,b as Me,d as te,e as ie}from"./chunk-2NLAH6WF.js";import{f as ne,g as oe}from"./chunk-7ADWQQCS.js";import"./chunk-3B5E5M2C.js";import"./chunk-KDDLKMGZ.js";import{$a as B,E as he,ab as j,gb as De,hb as F,jb as W,kb as $,nb as Y,pb as Q,qb as J,r as U,rb as K,t as T,tb as X,ub as ye,vb as Z,wb as Ee,xb as ee,yb as qe,zb as Te}from"./chunk-XYURQZTM.js";import{$b as ve,Ab as E,Cb as b,Db as V,Fb as I,Gb as N,Hb as i,Hc as Ce,Ib as n,Jb as f,M as fe,Nb as C,Rb as _,S as pe,Sb as c,Wa as l,_b as xe,a as ce,ac as q,ba as v,bc as s,c as de,cb as _e,cc as R,dc as D,f as ue,fc as k,gc as M,hc as P,ia as d,ja as u,jc as w,kb as y,qb as x,tc as L,vc as O,wc as h,xa as g,xb as m,yb as ge}from"./chunk-LW3WOUBG.js";var at=()=>({height:"6px"});function lt(t,o){t&1&&(i(0,"div",4),f(1,"p-progressbar",6),n()),t&2&&(l(),E(w(2,at)))}function st(t,o){if(t&1&&s(0),t&2){let e,r=c(2);D(" ",(e=r.detail())==null?null:e.Circular," ")}}function pt(t,o){t&1&&(i(0,"span",10),s(1,"SIN PROCESAR"),n())}function mt(t,o){if(t&1&&(i(0,"dl",5)(1,"div",7)(2,"dt",8),s(3,"Tipo solicitud"),n(),i(4,"dd",9),s(5),n()(),i(6,"div",7)(7,"dt",8),s(8,"Estado"),n(),i(9,"dd",9),s(10),n()(),i(11,"div",7)(12,"dt",8),s(13,"Descripcion"),n(),i(14,"dd",9),s(15),n()(),i(16,"div",7)(17,"dt",8),s(18,"Circular"),n(),i(19,"dd",9),x(20,st,1,1)(21,pt,2,0,"span",10),n()(),i(22,"div",7)(23,"dt",8),s(24,"Fecha circular"),n(),i(25,"dd",9),s(26),n()()()),t&2){let e,r,a,p,S=c();l(5),D(" ",S.request.processTypeLabel," "),l(5),D(" ",(e=S.detail())==null?null:e.Estado," "),l(5),D(" ",(r=S.detail())==null?null:r.ErrorEnvio," "),l(5),b((a=S.detail())!=null&&a.Circular?20:21),l(6),D(" ",(p=S.detail())==null?null:p.FechaCircular," ")}}var se=class t{retentionService=v(ke);request=v(H).data;detail=g(null);isLoading=g(!0);ngOnInit(){this.getDetail()}getDetail(){this.retentionService.getDetailRequest(this.request.requestId,this.getTypeRequest()).pipe(fe(()=>this.isLoading.set(!1))).subscribe(o=>{this.detail.set(o)})}getTypeRequest(){switch(this.request.processType){case"R":return 1;case"S":return 2;default:return 4}}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=y({type:t,selectors:[["app-request-detail-dialog"]],decls:10,vars:6,consts:[[1,"px-4","sm:px-0"],[1,"text-base/7","font-semibold"],[1,"mt-1","max-w-2xl","text-lg","text-gray-500"],[1,"mt-6","border-t","border-gray-100"],[1,"card"],[1,"divide-y","divide-gray-100"],["mode","indeterminate"],[1,"px-4","py-6","sm:grid","sm:grid-cols-3","sm:gap-4","sm:px-0"],[1,"text-md","font-medium"],[1,"mt-1","text-md","text-gray-700","sm:col-span-2","sm:mt-0"],[1,"text-red-500"]],template:function(e,r){e&1&&(i(0,"div")(1,"div",0)(2,"h3",1),s(3),n(),i(4,"p",2),s(5),L(6,"date"),n()(),i(7,"div",3),x(8,lt,2,3,"div",4)(9,mt,27,5,"dl",5),n()()),e&2&&(l(3),D(" Solicitud: ",r.request.requestCode," "),l(2),D(" Registrado el ",O(6,3,r.request.createdAt,"short")," "),l(3),b(r.isLoading()?8:9))},dependencies:[T,U,$e,We],encapsulation:2,changeDetection:0})};var gt=()=>({severity:"secondary"}),xt=()=>({"min-width":"75rem"}),vt=()=>["documentNumber","firstName","paternalLastName","maternalLastName"],Ct=()=>({width:"40rem"}),ht=()=>({"1199px":"75vw","575px":"90vw"});function St(t,o){if(t&1&&(i(0,"div",26),f(1,"i",29),i(2,"span",30),s(3),n()()),t&2){let e=c(2);l(3),R(e.selectedFileName())}}function bt(t,o){t&1&&(i(0,"span"),s(1,"Nota de solicitud dirigida a ASFI - (PDF)"),n())}function wt(t,o){if(t&1){let e=C();i(0,"form",14)(1,"div",15)(2,"div",16)(3,"p-floatlabel"),f(4,"input",17),i(5,"label"),s(6,"Nombre Autoridad Solicitante"),n()()(),i(7,"div",16)(8,"p-floatlabel"),f(9,"input",18),i(10,"label"),s(11,"Cargo Autoridad Solicitante"),n()()(),i(12,"div",19)(13,"p-floatlabel"),f(14,"input",20),i(15,"label"),s(16,"Codigo Solicitud (CITE)"),n()()(),i(17,"div"),f(18,"p-select",21),n(),i(19,"div")(20,"p-floatlabel"),f(21,"input",22),i(22,"label"),s(23,"Gerencia Solicitante"),n()()(),i(24,"div",23)(25,"div",24)(26,"p-fileupload",25),_("onSelect",function(a){d(e);let p=c();return u(p.onFileSelect(a))}),n(),i(27,"div"),x(28,St,4,1,"div",26)(29,bt,2,0,"span"),n()()()()(),i(30,"div",27)(31,"p-button",28),_("onClick",function(){let a=d(e).activateCallback;return u(a(2))}),n()()}if(t&2){let e=c();m("formGroup",e.form),l(18),m("options",e.PROCESS_TYPES),l(8),m("auto",!0),l(2),b(e.selectedFileName()?28:29)}}function Rt(t,o){if(t&1){let e=C();i(0,"p-button",36),_("onClick",function(){d(e);let a=c(2);return u(a.datasource.set([]))}),n()}if(t&2){let e=c(2);m("disabled",e.datasource().length===0)}}function Dt(t,o){if(t&1){let e=C();i(0,"div",37)(1,"a",38),f(2,"i",39),n(),i(3,"p-fileUpload",40),_("onSelect",function(a){d(e);let p=c(2);return u(p.loadExcel(a))}),n()()}t&2&&(l(3),m("chooseButtonProps",w(1,gt)))}function yt(t,o){if(t&1){let e=C();i(0,"div",41)(1,"p-iconField",42)(2,"p-inputIcon"),f(3,"i",43),n(),i(4,"input",44),_("input",function(a){d(e),c();let p=q(1),S=c(2);return u(S.onGlobalFilterTable(p,a))}),n()()()}}function Et(t,o){if(t&1&&(i(0,"th")(1,"div",46),s(2),n()()),t&2){let e,r=o.$implicit;ge("min-width",(e=r.width)!==null&&e!==void 0?e:"15rem"),l(2),R(r.header)}}function qt(t,o){if(t&1&&(i(0,"tr"),I(1,Et,3,3,"th",45,V),n()),t&2){let e=c(3);l(),N(e.COLUMNS)}}function Tt(t,o){if(t&1&&(i(0,"td"),s(1),n()),t&2){let e=o.$implicit,r=c().$implicit;l(),R(r[e.columnDef])}}function Ft(t,o){if(t&1&&(i(0,"tr"),I(1,Tt,2,1,"td",null,V),n()),t&2){let e=c(3);l(),N(e.COLUMNS)}}function At(t,o){if(t&1&&(i(0,"tr")(1,"td",47),s(2,"Sin registros"),n()()),t&2){let e=c(3);l(),m("colSpan",e.COLUMNS.length)}}function Vt(t,o){if(t&1&&(i(0,"p-table",32,3),x(2,yt,5,0,"ng-template",null,4,h)(4,qt,3,0,"ng-template",null,5,h)(6,Ft,3,0,"ng-template",null,6,h)(8,At,3,1,"ng-template",null,7,h),n()),t&2){let e=c(2);m("value",e.datasource())("rows",10)("paginator",!0)("showCurrentPageReport",!0)("tableStyle",w(7,xt))("alwaysShowPaginator",e.datasource().length>5)("globalFilterFields",w(8,vt))}}function It(t,o){t&1&&(i(0,"div",33),s(1," No hay personas registradas en la solicitud "),n())}function Nt(t,o){if(t&1){let e=C();i(0,"p-toolbar",31),x(1,Rt,1,1,"ng-template",null,1,h)(3,Dt,4,2,"ng-template",null,2,h),n(),x(5,Vt,10,9,"p-table",32)(6,It,2,0,"div",33),i(7,"div",34)(8,"p-button",35),_("onClick",function(){let a=d(e).activateCallback;return u(a(1))}),n()()}if(t&2){let e=c();l(5),b(e.datasource().length>0?5:6)}}function kt(t,o){if(t&1&&(i(0,"p"),s(1),n()),t&2){let e=o.$implicit;l(),R(e)}}function Mt(t,o){if(t&1){let e=C();i(0,"p-dialog",48),P("visibleChange",function(a){d(e);let p=c();return M(p.isErrorDialogShowing,a)||(p.isErrorDialogShowing=a),u(a)}),I(1,kt,2,1,"p",null,V),n()}if(t&2){let e=c();E(w(6,Ct)),m("modal",!0)("draggable",!1),k("visible",e.isErrorDialogShowing),m("breakpoints",w(7,ht)),l(),N(e.errorMessages())}}var A=class t{formBuilder=v(K);excelService=v(Me);dialogRef=v(Se);messageService=v(Re);asfiRequestService=v(te);fileUploadService=v(ie);data=v(H).data;COLUMNS=[{header:"Item",columnDef:"item",width:"40px"},{header:"Nombres",columnDef:"firstName",width:"15rem"},{header:"Apellido Paterno",columnDef:"paternalLastName"},{header:"Apellido Materno",columnDef:"maternalLastName"},{header:"Tipo Documento",columnDef:"documentType"},{header:"Numero Documento",columnDef:"documentNumber"},{header:"Complemento",columnDef:"complement"},{header:"Extension",columnDef:"extension",width:"100px"},{header:"Auto Conclusion",columnDef:"autoConclusion"},{header:"Documento Respaldo",columnDef:"supportDocument"},{header:"Razon Social",columnDef:"businessName"},{header:"Monto",columnDef:"amount"},{header:"Tipo Respaldo",columnDef:"supportType"}];PROCESS_TYPES=[{value:"R",label:"Retenci\xF3n"},{value:"S",label:"Suspensi\xF3n"}];datasource=g([]);form=this.formBuilder.group({authorityPosition:["",F.required],requestingAuthority:["",F.required],requestCode:["",F.required],department:["",F.required],processType:["",F.required]});isErrorDialogShowing=g(!1);errorMessages=g([]);selectedFile=g(null);selectedFileName=g(null);ngOnInit(){this.loadFormData()}save(){if(!this.isFormValid)return;this.buildSaveMethod().subscribe({next:e=>{this.dialogRef.close(e)},error:e=>{e instanceof he&&this.handleHtttErrrors(e)}})}onGlobalFilterTable(o,e){o.filterGlobal(e.target.value,"contains")}onFileSelect(o){let[e]=o.files;e&&e.type!=="application/pdf"||(this.selectedFile.set(e),this.selectedFileName.set(e.name))}close(){this.dialogRef.close()}loadExcel(o){return ue(this,null,function*(){let[e]=o.files;if(!e)return;let r=yield this.excelService.readExcelFile(e);this.datasource.set(this.excelDataToDto(r))})}get isFormValid(){return this.data?this.form.valid&&this.datasource().length>0:this.form.valid&&this.datasource().length>0&&this.selectedFile()}excelDataToDto(o){return o.map(e=>({item:e.Item.toString(),maternalLastName:e["Apellido Materno"],paternalLastName:e["Apellido Paterno"],autoConclusion:e["Auto Conclusion"],complement:e["Tipo Documento"],extension:e.Extension,documentNumber:e["Numero Documento"],documentType:e["Tipo Documento"],supportDocument:e["Documento Respaldo"],amount:e.Monto,firstName:e.Nombres,businessName:e["Razon Social"],supportType:e["Tipo Respaldo"]}))}handleHtttErrrors(o){let{message:e}=o.error;switch(o.status){case 409:let r=o.error.request;this.messageService.message({header:"Error al registrar la solicitud",description:typeof e=="string"?e:"La solicitud es invalida"}),this.dialogRef.close(r);break;case 400:Array.isArray(e)&&(this.errorMessages.set(this.parseValidationErrors(e)),this.isErrorDialogShowing.set(!0));break;default:break}}parseValidationErrors(o){return o.map(e=>{let r=e.split(".",3);if(r.length<=2)return r.join(".");let a=parseInt(r[1],10),p=r.slice(2).join(".");return`Fila ${a+1}: ${p.trim()}`})}loadFormData(){if(!this.data)return;let r=this.data,{file:o}=r,e=de(r,["file"]);this.form.patchValue(e),this.selectedFileName.set(o.originalName)}buildSaveMethod(){return this.data?this.selectedFile()?this.fileUploadService.uploadAsfiNote(this.selectedFile()).pipe(pe(o=>this.asfiRequestService.update({id:this.data.id,form:this.form.value,details:this.datasource(),file:o}))):this.asfiRequestService.update({id:this.data.id,form:this.form.value,details:this.datasource()}):this.fileUploadService.uploadAsfiNote(this.selectedFile()).pipe(pe(o=>this.asfiRequestService.create(this.form.value,this.datasource(),o)))}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=y({type:t,selectors:[["app-request-dialog"]],decls:18,vars:7,consts:[["content",""],["start",""],["end",""],["dt",""],["caption",""],["header",""],["body",""],["emptymessage",""],[1,"p-dialog-content"],[3,"value"],[1,"p-dialog-footer"],["label","Cancelar","severity","danger","variant","outlined",3,"onClick"],["label","Guardar",3,"onClick","disabled"],["header","Errores Formato",3,"modal","draggable","visible","style","breakpoints"],[3,"formGroup"],[1,"grid","grid-cols-4","gap-y-8","gap-x-4"],[1,"col-span-2"],["pInputText","","formControlName","requestingAuthority",1,"w-full"],["pInputText","","formControlName","authorityPosition",1,"w-full"],[1,"sm:col-span-2"],["pInputText","","formControlName","requestCode",1,"w-full"],["optionLabel","label","optionValue","value","placeholder","Tipo proceso","formControlName","processType",1,"w-full",3,"options"],["pInputText","","formControlName","department",1,"w-full"],[1,"col-span-4"],[1,"flex","flex-col","sm:flex-row","items-center","gap-4"],["mode","basic","chooseIcon","pi pi-upload","accept",".pdf","chooseLabel","Seleccionar",3,"onSelect","auto"],[1,"px-3","py-2","rounded-md","bg-green-50","ring-1","ring-green-500","text-black"],[1,"flex","py-4","justify-end"],["icon","pi pi-arrow-right","label","Siguiente","iconPos","right","size","small","severity","secondary",3,"onClick"],[1,"pi","pi-file-pdf"],[1,"ml-2"],[1,"p-0","m-0"],["currentPageReportTemplate","{first} - {last} de {totalRecords} Registros","paginatorDropdownAppendTo","body",3,"value","rows","paginator","showCurrentPageReport","tableStyle","alwaysShowPaginator","globalFilterFields"],[1,"px-4","py-6","font-medium","text-lg"],[1,"flex","py-4","justify-between"],["label","Atras","severity","secondary","size","small","icon","pi pi-arrow-left",3,"onClick"],["severity","danger","label","Remover","icon","pi pi-trash","outlined","",3,"onClick","disabled"],[1,"flex","gap-x-2"],["severity","secondary","href","files/formato-cabeceras.xlsx",1,"p-button"],[1,"pi","pi-arrow-down"],["mode","basic","accept",".xlsx,.ods","chooseLabel","Importar","auto","","customUpload","",1,"mr-2","inline-block",3,"onSelect","chooseButtonProps"],[1,"flex","justify-end"],["iconPosition","left"],[1,"pi","pi-search"],["pInputText","","type","text","placeholder","Nombres / Nro. Documento",3,"input"],[3,"min-width"],[1,"flex","items-center"],[3,"colSpan"],["header","Errores Formato",3,"visibleChange","modal","draggable","visible","breakpoints"]],template:function(e,r){if(e&1){let a=C();i(0,"div",8)(1,"p-stepper",9)(2,"p-step-list")(3,"p-step",9),s(4,"Detalle Solicitud"),n(),i(5,"p-step",9),s(6,"Personas Afectadas"),n()(),i(7,"p-step-panels")(8,"p-step-panel",9),x(9,wt,32,4,"ng-template",null,0,h),n(),i(11,"p-step-panel",9),x(12,Nt,9,1,"ng-template",null,0,h),n()()()(),i(14,"div",10)(15,"p-button",11),_("onClick",function(){return d(a),u(r.close())}),n(),i(16,"p-button",12),_("onClick",function(){return d(a),u(r.save())}),n()(),x(17,Mt,3,8,"p-dialog",13)}e&2&&(l(),m("value",1),l(2),m("value",1),l(2),m("value",2),l(3),m("value",1),l(3),m("value",2),l(5),m("disabled",!r.isFormValid),l(),b(r.isErrorDialogShowing()?17:-1))},dependencies:[T,X,Y,De,W,$,Q,J,tt,et,Je,Ze,Xe,Ke,j,B,ae,re,Qe,Ye,Te,qe,Pe,oe,ne,Z,ye,ee,Ee,le,ze,G,z],encapsulation:2})};var Pt=["op"],Lt=()=>({"min-width":"50rem"}),Ot=()=>({width:"50vw"}),Ut=()=>({"1199px":"75vw","575px":"90vw"});function Bt(t,o){if(t&1){let e=C();i(0,"div",13)(1,"search-input",27),_("onSearch",function(a){d(e);let p=c();return u(p.search(a))}),n()()}}function jt(t,o){t&1&&(i(0,"tr"),f(1,"th",28),i(2,"th"),s(3,"Codigo"),n(),i(4,"th"),s(5,"Archivo"),n(),i(6,"th"),s(7,"Tipo"),n(),i(8,"th"),s(9,"Circular"),n(),i(10,"th"),s(11,"Creacion"),n(),i(12,"th"),s(13,"Cantidad"),n(),f(14,"th",28),n())}function zt(t,o){t&1&&f(0,"i",29)}function Gt(t,o){t&1&&f(0,"i",30)}function Ht(t,o){t&1&&f(0,"i",31)}function Wt(t,o){if(t&1&&s(0),t&2){let e=c().$implicit;D(" ",e.circularNumber," ")}}function $t(t,o){t&1&&(i(0,"span",33),s(1,"Sin asignar"),n())}function Yt(t,o){if(t&1){let e=C();i(0,"tr")(1,"td"),x(2,zt,1,0,"i",29)(3,Gt,1,0,"i",30)(4,Ht,1,0,"i",31),n(),i(5,"td"),s(6),n(),i(7,"td")(8,"p-button",32),_("onClick",function(){let a=d(e).$implicit,p=c();return u(p.showFile(a))}),n()(),i(9,"td"),s(10),n(),i(11,"td"),x(12,Wt,1,1)(13,$t,2,0,"span",33),n(),i(14,"td"),s(15),L(16,"date"),n(),i(17,"td"),s(18),n(),i(19,"td")(20,"p-menu",34,5),_("onShow",function(){let a=d(e).$implicit,p=c();return u(p.onShowOptionsMenu(a))}),n(),i(22,"p-button",35),_("onClick",function(a){d(e);let p=q(21);return u(p.toggle(a))}),n()()()}if(t&2){let e,r=o.$implicit,a=c();l(2),b((e=r.status)==="pending"?2:e==="completed"?3:4),l(4),R(r.requestCode),l(4),R(r.processTypeLabel),l(2),b(r.circularNumber?12:13),l(3),R(O(16,10,r.createdAt,"short")),l(3),R(r.quantityDetail),l(2),m("popup",!0)("model",a.menuOptions()),l(2),m("rounded",!0)("text",!0)}}function Qt(t,o){t&1&&(i(0,"tr")(1,"td",36),s(2,"Sin registros"),n()()),t&2&&(l(),m("colSpan",7))}function Jt(t,o){if(t&1){let e=C();i(0,"div",13)(1,"p-paginator",37),_("onPageChange",function(a){d(e);let p=c();return u(p.onPageChange(a))}),n()()}if(t&2){let e=c();l(),m("rows",e.limit())("first",e.offset())("totalRecords",e.datasize())("showCurrentPageReport",!0)("showPageLinks",!1)("showJumpToPageDropdown",!1)}}function Kt(t,o){if(t&1){let e=C();i(0,"p-dialog",38),P("visibleChange",function(a){d(e);let p=c();return M(p.isShowingFile,a)||(p.isShowingFile=a),u(a)}),_("onHide",function(){d(e);let a=c();return u(a.closeFileDialog())}),i(1,"span",39),s(2,"Archivo adjuntado"),n(),f(3,"pdf-viewer",40),n()}if(t&2){let e=c();E(w(8,Ot)),m("modal",!0),k("visible",e.isShowingFile),m("breakpoints",w(9,Ut)),l(3),m("src",e.currentFileUrl())("render-text",!1)("original-size",!1)}}var me=class t{asfiRequestService=v(te);dialogService=v(we);formBuilder=v(K);fileService=v(ie);popoverRef=_e.required("op");datasource=g([]);datasize=g(0);limit=g(10);index=g(0);offset=Ce(()=>this.limit()*this.index());term=g("");isShowingFile=g(!1);currentFileUrl=g("");menuOptions=g([]);PROCESS_TYPES=[{value:"R",label:"Retencion"},{value:"S",label:"Suspension"}];STATUS=[{value:"pending",label:"Pendientes"},{value:"completed",label:"Completados"}];STATES=[{value:!0,label:"Con circular"},{value:!1,label:"Sin circular"}];filterForm=this.formBuilder.group({createdAt:[""],processType:[""],status:[""],isAproved:[""]});ngOnInit(){this.getData()}search(o){this.term.set(o),this.index.set(0),this.getData()}filter(){this.index.set(0),this.popoverRef().hide(),this.getData()}resetFilter(){this.filterForm.reset(),this.filter()}onPageChange({rows:o=10,page:e=0}){this.limit.set(o),this.index.set(e),this.getData()}create(){this.dialogService.open(A,{header:"Crear Solicitud",maximizable:!0,modal:!0,width:"50vw",breakpoints:{"960px":"75vw","640px":"90vw"}}).onClose.subscribe(e=>{e&&(this.datasource.update(r=>[e,...r].slice(0,this.limit())),this.datasize.update(r=>r+=1))})}update(o){this.dialogService.open(A,{header:"Editar Solicitud",maximizable:!0,modal:!0,width:"50vw",breakpoints:{"960px":"75vw","640px":"90vw"},data:o}).onClose.subscribe(r=>{r&&(this.datasource.update(a=>{let p=a.findIndex(({id:S})=>S===r.id);return p===-1?a:(a[p]=r,[...a])}),this.datasize.update(a=>a+=1))})}showDetail(o){this.dialogService.open(se,{header:"Detalle Solicitud",data:o,modal:!0,width:"50vw",focusOnShow:!1,closable:!0,breakpoints:{"960px":"75vw","640px":"90vw"}})}showFile(o){this.fileService.getFile(o.file.fileName).subscribe(e=>{let r=new Blob([e],{type:"application/pdf"}),a=URL.createObjectURL(r);this.currentFileUrl.set(a),this.isShowingFile.set(!0)})}onShowOptionsMenu(o){this.menuOptions.set([{label:"Opciones",items:[{icon:"pi pi-pencil",label:"Editar solicitud",disabled:o.status!=="pending",command:()=>{this.update(o)}},{icon:"pi pi-info-circle",label:"Detalle solicitud",command:()=>{this.showDetail(o)}}]}])}get isFilterFormValid(){return Object.values(this.filterForm.value).some(o=>o)}getData(){this.asfiRequestService.getRequests(ce({limit:this.limit(),offset:this.offset(),term:this.term()},this.filterForm.value)).subscribe(o=>{this.datasource.set(o.requests),this.datasize.set(o.length)})}closeFileDialog(){URL.revokeObjectURL(this.currentFileUrl()),this.currentFileUrl.set(""),this.isShowingFile.set(!1)}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=y({type:t,selectors:[["app-asfi-request"]],viewQuery:function(e,r){e&1&&xe(r.popoverRef,Pt,5),e&2&&ve()},decls:38,vars:13,consts:[["caption",""],["header",""],["body",""],["emptymessage",""],["op",""],["menu",""],[1,"flex","items-center","justify-between"],[1,"font-medium","text-2xl"],[1,"flex","gap-x-4"],["icon","pi pi-filter",3,"click"],["label","Agregar","icon","pi pi-plus",3,"onClick"],[1,"card","mt-4"],[3,"value","tableStyle"],[1,"flex","justify-end"],["header","Archivo Adjunto",3,"modal","visible","breakpoints","style"],[1,"flex","flex-col","gap-4","w-[25rem]","p-2"],[1,"text-xl"],["icon","pi pi-times",3,"onClick","text"],[3,"formGroup"],[1,"mt-4","flex","flex-col","gap-y-4"],["optionLabel","label","placeholder","Tipo de solicitud","optionValue","value","formControlName","processType",1,"w-full",3,"options"],["optionLabel","label","placeholder","Estado del envio","optionValue","value","formControlName","status",1,"w-full",3,"options"],["inputId","icondisplay","styleClass","w-full","placeholder","Fecha creacion","optionValue","value","formControlName","createdAt",1,"w-full",3,"iconDisplay","showIcon"],["optionLabel","label","placeholder","Asignacion circular","optionValue","value","formControlName","isAproved",1,"w-full",3,"options"],[1,"flex","justify-end","gap-x-2","mt-4"],["label","Limpiar","severity","secondary",3,"onClick"],["label","Filtrar",3,"onClick","disabled"],["placeholder","Buscar",3,"onSearch"],[2,"width","4rem"],[1,"pi","pi-exclamation-triangle",2,"color","orange"],[1,"pi","pi-verified",2,"color","green"],[1,"pi","pi-question-circle"],["severity","secondary","label","Adjunto","icon","pi pi-file-pdf","size","small",1,"truncate",3,"onClick"],[1,"text-red-500"],["appendTo","body",3,"onShow","popup","model"],["icon","pi pi-ellipsis-v",3,"onClick","rounded","text"],[3,"colSpan"],["currentPageReportTemplate","{first} - {last} de {totalRecords} Registros",3,"onPageChange","rows","first","totalRecords","showCurrentPageReport","showPageLinks","showJumpToPageDropdown"],["header","Archivo Adjunto",3,"visibleChange","onHide","modal","visible","breakpoints"],[1,"p-text-secondary","block","mb-8"],[2,"width","100%","height","500px",3,"src","render-text","original-size"]],template:function(e,r){if(e&1){let a=C();i(0,"div",6)(1,"span",7),s(2,"Retenciones / Suspensiones"),n(),i(3,"div",8)(4,"p-button",9),_("click",function(S){d(a);let ot=q(19);return u(ot.toggle(S))}),n(),i(5,"p-button",10),_("onClick",function(){return d(a),u(r.create())}),n()()(),i(6,"div",11)(7,"p-table",12),x(8,Bt,2,0,"ng-template",null,0,h)(10,jt,15,0,"ng-template",null,1,h)(12,Yt,23,13,"ng-template",null,2,h)(14,Qt,3,1,"ng-template",null,3,h),n(),x(16,Jt,2,6,"div",13),n(),x(17,Kt,4,10,"p-dialog",14),i(18,"p-popover",null,4)(20,"div",15)(21,"div",6)(22,"div",16),s(23,"Filtro avanzado"),n(),i(24,"p-button",17),_("onClick",function(){d(a);let S=q(19);return u(S.hide())}),n()(),i(25,"form",18)(26,"div",19)(27,"div"),f(28,"p-select",20),n(),i(29,"div"),f(30,"p-select",21),n(),i(31,"div"),f(32,"p-datepicker",22),n(),i(33,"div"),f(34,"p-select",23),n()()(),i(35,"div",24)(36,"p-button",25),_("onClick",function(){return d(a),u(r.resetFilter())}),n(),i(37,"p-button",26),_("onClick",function(){return d(a),u(r.filter())}),n()()()()}e&2&&(l(7),m("value",r.datasource())("tableStyle",w(12,Lt)),l(9),b(r.datasize()>r.limit()?16:-1),l(),b(r.isShowingFile()?17:-1),l(7),m("text",!0),l(),m("formGroup",r.filterForm),l(3),m("options",r.PROCESS_TYPES),l(2),m("options",r.STATUS),l(2),m("iconDisplay","input")("showIcon",!0),l(2),m("options",r.STATES),l(3),m("disabled",!r.isFilterFormValid))},dependencies:[T,U,X,Y,W,$,Q,J,be,Be,Ue,He,Ge,Oe,Le,ee,Z,le,G,z,j,B,ae,re,je,Ne,Ie,Ve,Ae,oe,ne,Fe],encapsulation:2,changeDetection:0})};export{me as default};
