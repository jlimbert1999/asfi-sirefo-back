import{a as it,b as re,c as nt,d as ot,e as rt,f as at,g as lt,h as st,i as pt,j as mt,k as dt,l as ct,m as ut,n as ft,o as _t,p as gt,q as ht,r as Ct}from"./chunk-4I2BN4NF.js";import{a as Le,b as Be}from"./chunk-XYLEAZTU.js";import{a as He}from"./chunk-4DE5AXM7.js";import{a as We,b as $e}from"./chunk-TTY7FAQP.js";import{b as Pe}from"./chunk-WRWHG35S.js";import{a as et,b as tt}from"./chunk-YIPVTPHC.js";import{a as Oe,b as Ue}from"./chunk-YYO54SXT.js";import"./chunk-R3IN7URU.js";import{a as je}from"./chunk-BPMMOJO4.js";import{d as Se,e as j,f as Fe,g as be,h as Te,i as we,j as ye,m as ke,n as Ie,o as qe}from"./chunk-MBILNKQQ.js";import{b as Ye,c as Je,d as Qe,e as Ze,f as Ke,g as Xe,h as ne,i as oe}from"./chunk-52TP4QYS.js";import"./chunk-UPP2M2S6.js";import{b as ze,c as te,d as Ge,e as ie}from"./chunk-7VMHK3EI.js";import{Ab as ee,E as xe,Va as z,Wa as G,ab as De,bb as F,db as W,eb as $,hb as H,jb as Y,kb as J,lb as Q,mb as Ee,nb as Z,pb as K,r as Ce,rb as X,sb as Ae,t as U,tb as Ve,va as ve,xb as Re,yb as Me,zb as Ne}from"./chunk-G3ZQPBPZ.js";import{$b as ge,Ab as fe,C as me,Cb as S,Db as P,Fb as L,G as de,Gb as B,Hb as o,Hc as he,Ib as r,Jb as C,Nb as x,Rb as f,S as le,Sb as m,Wa as l,_b as _e,a as D,ac as O,b as ae,ba as h,bc as p,c as pe,cb as ce,cc as w,dc as b,fc as A,gc as V,hc as R,ia as c,ja as u,jc as y,kb as q,qb as g,s as I,tc as M,vc as N,wc as v,xa as _,xb as d,yb as ue}from"./chunk-LW3WOUBG.js";var Tt=()=>({severity:"secondary"}),wt=()=>({"min-width":"75rem"}),yt=()=>["documentNumber","firstName","paternalLastName","maternalLastName"],Dt=()=>({width:"40rem"}),Et=()=>({"1199px":"75vw","575px":"90vw"});function At(t,i){if(t&1&&(o(0,"p-message",18),p(1),M(2,"formErrorMessages"),r()),t&2){let e,n=m(2);l(),b(" ",N(2,1,(e=n.form.get("requestingAuthority"))==null?null:e.errors,n.formMessages==null?null:n.formMessages.requestingAuthority)," ")}}function Vt(t,i){if(t&1&&(o(0,"p-message",18),p(1),M(2,"formErrorMessages"),r()),t&2){let e,n=m(2);l(),b(" ",N(2,1,(e=n.form.get("authorityPosition"))==null?null:e.errors,n.formMessages==null?null:n.formMessages.authorityPosition)," ")}}function Rt(t,i){if(t&1&&(o(0,"div",28),C(1,"i",31),o(2,"span",32),p(3),r()()),t&2){let e=m(2);l(3),w(e.pdfFileName())}}function Mt(t,i){t&1&&(o(0,"span"),p(1,"Nota de solicitud dirigida a ASFI - (PDF)"),r())}function Nt(t,i){if(t&1){let e=x();o(0,"form",14)(1,"div",15)(2,"div",16)(3,"p-floatlabel"),C(4,"input",17),o(5,"label"),p(6,"Nombre Autoridad Solicitante"),r()(),g(7,At,3,4,"p-message",18),r(),o(8,"div",16)(9,"p-floatlabel"),C(10,"input",19),o(11,"label"),p(12,"Cargo Autoridad Solicitante"),r()(),g(13,Vt,3,4,"p-message",18),r(),o(14,"div")(15,"p-inputgroup")(16,"p-inputgroup-addon",20),p(17," CE/SF-DRT-72 "),r(),o(18,"p-floatlabel",21),C(19,"p-inputnumber",22),o(20,"label"),p(21,"Nro. Cite"),r()(),o(22,"p-inputgroup-addon",23),p(23),r()()(),o(24,"div",16)(25,"p-floatlabel"),C(26,"input",24),o(27,"label"),p(28,"Gerencia Solicitante"),r()()(),o(29,"div",25)(30,"div",26)(31,"p-fileupload",27),f("onSelect",function(a){c(e);let s=m();return u(s.onPdfSelect(a))}),r(),o(32,"div"),g(33,Rt,4,1,"div",28)(34,Mt,2,0,"span"),r()()()()(),o(35,"div",29)(36,"p-button",30),f("onClick",function(){let a=c(e).activateCallback;return u(a(2))}),r()()}if(t&2){let e,n,a=m();d("formGroup",a.form),l(7),S((e=a.form.get("requestingAuthority"))!=null&&e.hasError&&((e=a.form.get("requestingAuthority"))!=null&&e.touched)?7:-1),l(6),S((n=a.form.get("authorityPosition"))!=null&&n.hasError&&((n=a.form.get("authorityPosition"))!=null&&n.touched)?13:-1),l(6),d("useGrouping",!1)("min",1)("max",99999),l(4),b(" ",a.YEAR," "),l(10),S(a.pdfFileName()?33:34)}}function kt(t,i){if(t&1){let e=x();o(0,"p-button",38),f("onClick",function(){c(e);let a=m(2);return u(a.datasource.set([]))}),r()}if(t&2){let e=m(2);d("disabled",e.datasource().length===0)}}function It(t,i){if(t&1){let e=x();o(0,"div",39)(1,"p-button",40),f("onClick",function(){c(e);let a=m(2);return u(a.isInfoDialogShowing.set(!0))}),r(),o(2,"a",41),C(3,"i",42),r(),o(4,"p-fileUpload",43),f("onSelect",function(a){c(e);let s=m(2);return u(s.onSpreadSheetSelect(a))}),r()()}t&2&&(l(4),d("chooseButtonProps",y(1,Tt)))}function qt(t,i){if(t&1&&(o(0,"th")(1,"div",45),p(2),r()()),t&2){let e,n=i.$implicit;ue("min-width",(e=n.width)!==null&&e!==void 0?e:"15rem"),l(2),w(n.header)}}function Pt(t,i){if(t&1&&(o(0,"tr"),L(1,qt,3,3,"th",44,P),r()),t&2){let e=m(3);l(),B(e.COLUMNS)}}function Lt(t,i){if(t&1&&(o(0,"td"),p(1),r()),t&2){let e=i.$implicit,n=m().$implicit;l(),w(n[e.columnDef])}}function Bt(t,i){if(t&1&&(o(0,"tr"),L(1,Lt,2,1,"td",null,P),r()),t&2){let e=m(3);l(),B(e.COLUMNS)}}function Ot(t,i){if(t&1&&(o(0,"tr")(1,"td",46),p(2,"Sin registros"),r()()),t&2){let e=m(3);l(),d("colSpan",e.COLUMNS.length)}}function Ut(t,i){if(t&1&&(o(0,"p-table",34,3),g(2,Pt,3,0,"ng-template",null,4,v)(4,Bt,3,0,"ng-template",null,5,v)(6,Ot,3,1,"ng-template",null,6,v),r()),t&2){let e=m(2);d("value",e.datasource())("rows",8)("paginator",!0)("showCurrentPageReport",!0)("tableStyle",y(7,wt))("alwaysShowPaginator",e.datasource().length>5)("globalFilterFields",y(8,yt))}}function zt(t,i){t&1&&(o(0,"div",35),p(1," No hay personas registradas en la solicitud "),r())}function Gt(t,i){if(t&1){let e=x();o(0,"p-toolbar",33),g(1,kt,1,1,"ng-template",null,1,v)(3,It,5,2,"ng-template",null,2,v),r(),g(5,Ut,8,9,"p-table",34)(6,zt,2,0,"div",35),o(7,"div",36)(8,"p-button",37),f("onClick",function(){let a=c(e).activateCallback;return u(a(1))}),r(),o(9,"p-button",30),f("onClick",function(){let a=c(e).activateCallback;return u(a(3))}),r()()}if(t&2){let e=m();l(5),S(e.datasource().length>0?5:6)}}function jt(t,i){if(t&1&&(o(0,"div",49)(1,"dl",50)(2,"div",51)(3,"dt",52),p(4,"Cite:"),r(),o(5,"dd",53),p(6),r()(),o(7,"div",51)(8,"dt",52),p(9,"Numero circular:"),r(),o(10,"dd",53),p(11),r()(),o(12,"div",51)(13,"dt",52),p(14,"Cantidad registros:"),r(),o(15,"dd",53),p(16),r()()()()),t&2){let e,n,a,s=m(2);l(6),b(" ",(e=s.selectedAsfiRequest())==null?null:e.requestCode," "),l(5),b(" ",(n=s.selectedAsfiRequest())==null?null:n.circularNumber," "),l(5),b(" ",(a=s.selectedAsfiRequest())==null?null:a.quantityDetail," ")}}function Wt(t,i){t&1&&(o(0,"div",35),p(1," Seleccione una solicitud de retencion procesada (Con numero de circular) "),r())}function $t(t,i){if(t&1){let e=x();o(0,"div",47)(1,"select-search",48),f("onSearch",function(a){c(e);let s=m();return u(s.searchAprovedRequests(a))})("onSelect",function(a){c(e);let s=m();return u(s.onSelectAprovedRequest(a))}),r(),g(2,jt,17,3,"div",49)(3,Wt,2,0,"div",35),r(),o(4,"div",36)(5,"p-button",37),f("onClick",function(){let a=c(e).activateCallback;return u(a(2))}),r()()}if(t&2){let e=m();l(),d("data",e.aprovedRequests()),l(),S(e.selectedAsfiRequest()?2:3)}}function Ht(t,i){if(t&1&&(o(0,"p"),p(1),r()),t&2){let e=i.$implicit;l(),w(e)}}function Yt(t,i){if(t&1){let e=x();o(0,"p-dialog",54),R("visibleChange",function(a){c(e);let s=m();return V(s.isErrorDialogShowing,a)||(s.isErrorDialogShowing=a),u(a)}),L(1,Ht,2,1,"p",null,P),r()}if(t&2){let e=m();fe(y(6,Dt)),d("modal",!0)("draggable",!1),A("visible",e.isErrorDialogShowing),d("breakpoints",y(7,Et)),l(),B(e.errorMessages())}}function Jt(t,i){if(t&1){let e=x();o(0,"data-format-dialog",55),R("isVisibleChange",function(a){c(e);let s=m();return V(s.isInfoDialogShowing,a)||(s.isInfoDialogShowing=a),u(a)}),r()}if(t&2){let e=m();A("isVisible",e.isInfoDialogShowing)}}var k=class t{formBuilder=h(Q);dialogRef=h(be);messageService=h(ve);excelService=h(ze);alertService=h(ye);fileUploadService=h(ie);requestService=h(te);asfiRequestService=h(Ge);user=h(Pe).user();YEAR=new Date().getFullYear();COLUMNS=[{header:"Item",columnDef:"item",width:"40px"},{header:"Nombres",columnDef:"firstName",width:"15rem"},{header:"Apellido Paterno",columnDef:"paternalLastName"},{header:"Apellido Materno",columnDef:"maternalLastName"},{header:"Tipo Documento",columnDef:"documentType"},{header:"Numero Documento",columnDef:"documentNumber"},{header:"Complemento",columnDef:"complement"},{header:"Extension",columnDef:"extension",width:"100px"},{header:"Documento Respaldo",columnDef:"supportDocument"},{header:"Razon Social",columnDef:"businessName"},{header:"Monto",columnDef:"amount"},{header:"Tipo Respaldo",columnDef:"supportType"},{header:"Numero Cuenta",columnDef:"accountNumber"},{header:"Cuenta Moneda",columnDef:"accountCurrency"},{header:"Codigo Envio",columnDef:"transferCode"}];formMessages={requestingAuthority:{pattern:"Solo letras, espacios y guiones, sin caracteres especiales",minWords:"Se requieren al menos 2 palabras"},authorityPosition:{pattern:"Solo letras, espacios y guiones, sin caracteres especiales"}};data=h(Fe).data;datasource=_([]);form=this.formBuilder.group({requestingAuthority:[this.user?.fullName,[F.required,F.minLength(5),F.pattern(/^[A-Za-zÁÉÍÓÚÑáéíóúñ' -]+$/),He.minWordsValidator(2)]],authorityPosition:[this.user?.position,[F.required,F.minLength(4),F.pattern(/^[A-Za-zÁÉÍÓÚÑáéíóúñ.\- ]+$/)]],requestCode:["",[F.required,F.min(1),F.max(99999)]],department:["",F.required]});pdfFile=_(null);pdfFileName=_(null);selectedAsfiRequest=_(null);spreadsheetFile=_(null);isErrorDialogShowing=_(!1);errorMessages=_([]);aprovedRequests=_([]);isInfoDialogShowing=_(!1);ngOnInit(){this.loadFormData()}save(){this.buildSaveMethod().subscribe({next:e=>{this.dialogRef.close(e)},error:e=>{e instanceof xe&&this.handleHtttErrrors(e)}})}onPdfSelect(i){let[e]=i.files;this.pdfFile.set(e),this.pdfFileName.set(e.name)}onSpreadSheetSelect(i){let[e]=i.files;if(!e)return;this.spreadsheetFile.set(e);let n=this.COLUMNS.map(({header:a})=>a);this.excelService.readExcelFile(e,n).subscribe({next:a=>{this.datasource.set(this.excelDataToDto(a))},error:()=>{this.messageService.add({severity:"warn",summary:"Formato incorrecto",detail:"No se puedo cargar el archivo"})}})}close(){this.dialogRef.close()}searchAprovedRequests(i){this.asfiRequestService.searchAprovedCodes(i).subscribe(e=>{let n=e.map(a=>({label:`Solicitud: ${a.requestCode}  (Circular: ${a.circularNumber})`,value:a}));this.aprovedRequests.set(n)})}onSelectAprovedRequest(i){this.selectedAsfiRequest.set(i)}get isFormValid(){return this.data?this.form.valid&&this.datasource().length>0&&this.selectedAsfiRequest():this.form.valid&&this.datasource().length>0&&this.selectedAsfiRequest()&&this.pdfFile()&&this.spreadsheetFile()}excelDataToDto(i){return i.map(e=>({item:e.Item,maternalLastName:e["Apellido Materno"],paternalLastName:e["Apellido Paterno"],complement:e["Tipo Documento"],extension:e.Extension,documentNumber:e["Numero Documento"],documentType:e["Tipo Documento"],supportDocument:e["Documento Respaldo"],amount:e.Monto,firstName:e.Nombres,businessName:e["Razon Social"],supportType:e["Tipo Respaldo"],accountNumber:e["Numero Cuenta"],accountCurrency:e["Cuenta Moneda"],transferCode:e["Codigo Envio"]}))}handleHtttErrrors(i){let{message:e}=i.error;switch(i.status){case 409:let n=i.error.request;this.alertService.message({header:"Error al registrar la solicitud",description:typeof e=="string"?e:"La solicitud es invalida"}),this.dialogRef.close(n);break;case 400:Array.isArray(e)&&(this.errorMessages.set(this.parseValidationErrors(e)),this.isErrorDialogShowing.set(!0));break;default:break}}parseValidationErrors(i){return i.map(e=>{let n=e.split(".",3);if(n.length<=2)return n.join(".");let a=parseInt(n[1],10),s=n.slice(2).join(".");return`Fila ${a+1}: ${s.trim()}`})}loadFormData(){if(!this.data)return;let T=this.data,{file:i,dataSheetFile:e,asfiRequest:n,requestCode:a}=T,s=pe(T,["file","dataSheetFile","asfiRequest","requestCode"]);this.form.patchValue(ae(D({},s),{requestCode:this.data.extractCorrelative().toString()})),this.selectedAsfiRequest.set(n),this.pdfFileName.set(i.originalName),this.fileUploadService.getFile(e).pipe(le(E=>this.excelService.readExcelFile(E)),de(()=>I([]))).subscribe(E=>{this.datasource.set(this.excelDataToDto(E))})}buildSaveMethod(){return me([this.pdfFile()?this.fileUploadService.uploadAsfiFile(this.pdfFile()):I(null),this.spreadsheetFile()?this.fileUploadService.uploadAsfiFile(this.spreadsheetFile()):I(null)]).pipe(le(([i,e])=>{let n=ae(D(D(D({},this.form.value),i&&{file:i}),e&&{dataSheetFile:e.fileName}),{asfiRequestId:this.selectedAsfiRequest()?.id});return this.data?this.requestService.update(this.data.id,n,this.datasource()):this.requestService.create(n,this.datasource())}))}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=q({type:t,selectors:[["app-asfi-fund-transfer-dialog"]],decls:24,vars:10,consts:[["content",""],["start",""],["end",""],["dt",""],["header",""],["body",""],["emptymessage",""],[1,"p-dialog-content"],[3,"value"],[1,"p-dialog-footer"],["label","Cancelar","severity","danger","variant","outlined",3,"onClick"],["label","Guardar",3,"onClick","disabled"],["header","Errores Formato",3,"modal","draggable","visible","style","breakpoints"],["mode","asfi-request-transfer",3,"isVisible"],[3,"formGroup"],[1,"grid","grid-cols-4","gap-y-8","gap-x-4"],[1,"col-span-2"],["pInputText","","formControlName","requestingAuthority",1,"w-full"],["severity","error","variant","simple","size","small","styleClass","mt-2 px-2"],["pInputText","","formControlName","authorityPosition",1,"w-full"],[1,"w-[220px]","text-xs"],[1,"w-[100px]"],["formControlName","requestCode","mode","decimal",3,"useGrouping","min","max"],[1,"w-[80px]","text-xs"],["pInputText","","formControlName","department",1,"w-full"],[1,"col-span-4"],[1,"flex","flex-col","sm:flex-row","items-center","gap-4"],["mode","basic","chooseIcon","pi pi-upload","accept",".pdf","auto","","customUpload","","chooseLabel","Seleccionar",3,"onSelect"],[1,"px-3","py-2","rounded-md","bg-green-50","ring-1","ring-green-500","text-black"],[1,"flex","py-4","justify-end"],["icon","pi pi-arrow-right","label","Siguiente","iconPos","right","size","small","severity","secondary",3,"onClick"],[1,"pi","pi-file-pdf"],[1,"ml-2"],[1,"p-0","m-0"],["currentPageReportTemplate","{first} - {last} de {totalRecords} Registros","paginatorDropdownAppendTo","body",3,"value","rows","paginator","showCurrentPageReport","tableStyle","alwaysShowPaginator","globalFilterFields"],[1,"px-4","py-6","font-medium","text-lg"],[1,"flex","py-4","justify-between"],["label","Atras","severity","secondary","size","small","icon","pi pi-arrow-left",3,"onClick"],["severity","danger","label","Remover","icon","pi pi-trash","outlined","",3,"onClick","disabled"],[1,"flex","gap-x-2"],["icon","pi pi-question","pTooltip","Descripcion de datos","tooltipPosition","bottom",3,"onClick"],["severity","secondary","href","files/Formato-Remision.ods","pTooltip","Descargar plantilla","tooltipPosition","bottom",1,"p-button"],[1,"pi","pi-arrow-down"],["mode","basic","accept",".xlsx,.ods","chooseLabel","Importar","auto","","customUpload","",1,"mr-2","inline-block",3,"onSelect","chooseButtonProps"],[3,"min-width"],[1,"flex","items-center"],[3,"colSpan"],[1,"flex","flex-col","gap-y-4"],["placeholder","Buscar solicitud de retencion (Procesada)","filterPlaceholder","Numero de CITE o CIRCULAR",3,"onSearch","onSelect","data"],[1,"flow-root","py-4"],[1,"-my-3","divide-gray-200","divide-y","text-lg"],[1,"grid","grid-cols-1","gap-1","py-3","sm:grid-cols-3","sm:gap-4"],[1,"font-medium"],[1,"sm:col-span-2"],["header","Errores Formato",3,"visibleChange","modal","draggable","visible","breakpoints"],["mode","asfi-request-transfer",3,"isVisibleChange","isVisible"]],template:function(e,n){if(e&1){let a=x();o(0,"div",7)(1,"p-stepper",8)(2,"p-step-list")(3,"p-step",8),p(4,"Detalle Solicitud"),r(),o(5,"p-step",8),p(6,"Personas Afectadas"),r(),o(7,"p-step",8),p(8,"Detalle Remision de Fondos "),r()(),o(9,"p-step-panels")(10,"p-step-panel",8),g(11,Nt,37,8,"ng-template",null,0,v),r(),o(13,"p-step-panel",8),g(14,Gt,10,1,"ng-template",null,0,v),r(),o(16,"p-step-panel",8),g(17,$t,6,2,"ng-template",null,0,v),r()()()(),o(19,"div",9)(20,"p-button",10),f("onClick",function(){return c(a),u(n.close())}),r(),o(21,"p-button",11),f("onClick",function(){return c(a),u(n.save())}),r()(),g(22,Yt,3,8,"p-dialog",12)(23,Jt,1,1,"data-format-dialog",13)}e&2&&(l(),d("value",1),l(2),d("value",1),l(2),d("value",2),l(2),d("value",3),l(3),d("value",1),l(3),d("value",2),l(3),d("value",3),l(5),d("disabled",!n.isFormValid),l(),S(n.isErrorDialogShowing()?22:-1),l(),S(n.isInfoDialogShowing()?23:-1))},dependencies:[U,Ee,H,De,W,$,Z,Y,J,Ct,ht,ut,gt,_t,ft,G,z,oe,ne,st,lt,Ve,Ae,je,ee,K,X,re,it,j,Se,$e,We,Me,Re,mt,pt,ct,dt,qe,Je,Ye,ke,rt],encapsulation:2,changeDetection:0})};var Qt=["op"],Zt=()=>({"min-width":"50rem"});function Kt(t,i){if(t&1){let e=x();o(0,"div",13)(1,"search-input",25),f("onSearch",function(a){c(e);let s=m();return u(s.search(a))}),r()()}}function Xt(t,i){t&1&&(o(0,"tr")(1,"th"),p(2,"Nro. Cite"),r(),o(3,"th"),p(4,"Nro Sirefo"),r(),o(5,"th"),p(6,"Circular"),r(),o(7,"th"),p(8,"Fecha Circular"),r(),o(9,"th",26),p(10,"Nota"),r(),o(11,"th"),p(12,"Estado"),r(),C(13,"th",27),r())}function ei(t,i){if(t&1&&p(0),t&2){let e=m().$implicit;b(" ",e.circularNumber," ")}}function ti(t,i){t&1&&(o(0,"span",28),p(1,"Sin asignar"),r())}function ii(t,i){t&1&&C(0,"p-tag",30)}function ni(t,i){t&1&&C(0,"p-tag",31)}function oi(t,i){t&1&&C(0,"p-tag",32)}function ri(t,i){t&1&&C(0,"p-tag",33)}function ai(t,i){if(t&1){let e=x();o(0,"tr")(1,"td"),p(2),r(),o(3,"td"),p(4),r(),o(5,"td"),g(6,ei,1,1)(7,ti,2,0,"span",28),r(),o(8,"td"),p(9),M(10,"date"),r(),o(11,"td")(12,"p-button",29),f("onClick",function(){let a=c(e).$implicit,s=m();return u(s.showFile(a))}),r()(),o(13,"td"),g(14,ii,1,0,"p-tag",30)(15,ni,1,0,"p-tag",31)(16,oi,1,0,"p-tag",32)(17,ri,1,0,"p-tag",33),r(),o(18,"td")(19,"p-menu",34,5),f("onShow",function(){let a=c(e).$implicit,s=m();return u(s.onShowOptionsMenu(a))}),r(),o(21,"p-button",35),f("onClick",function(a){c(e);let s=O(20);return u(s.toggle(a))}),r()()()}if(t&2){let e,n=i.$implicit,a=m();l(2),w(n.requestCode),l(2),w(n.asfiRequest.circularNumber),l(2),S(n.circularNumber?6:7),l(3),b(" ",n.circularDate?N(10,10,n.circularDate,"short"):"Sin fecha"," "),l(3),d("label",n.file.originalName)("link",!0),l(2),S((e=n.status)==="draft"?14:e==="sent"?15:e==="accepted"?16:17),l(5),d("popup",!0)("model",a.menuOptions()),l(2),d("text",!0)}}function li(t,i){t&1&&(o(0,"tr")(1,"td",36),p(2,"Sin registros"),r()()),t&2&&(l(),d("colSpan",7))}function si(t,i){if(t&1){let e=x();o(0,"div",13)(1,"p-paginator",37),f("onPageChange",function(a){c(e);let s=m();return u(s.onPageChange(a))}),r()()}if(t&2){let e=m();l(),d("rows",e.limit())("first",e.offset())("totalRecords",e.datasize())("showCurrentPageReport",!0)("showPageLinks",!1)("showJumpToPageDropdown",!1)}}function pi(t,i){if(t&1){let e=x();o(0,"asfi-note-display",38),R("visibleChange",function(a){c(e);let s=m();return V(s.isShowingFile,a)||(s.isShowingFile=a),u(a)}),r()}if(t&2){let e=m();d("url",e.selectedItem().file.fileName),A("visible",e.isShowingFile)}}var se=class t{formBuilder=h(Q);dialogService=h(we);requestService=h(te);fileService=h(ie);popoverRef=ce.required("op");datasource=_([]);datasize=_(0);limit=_(10);index=_(0);offset=he(()=>this.limit()*this.index());term=_("");isShowingFile=_(!1);selectedItem=_(null);menuOptions=_([]);formMessages={requestingAuthority:{pattern:"Solo letras, espacios y guiones, sin caracteres especiales",minWords:"Se requieren al menos 2 palabras"},authorityPosition:{pattern:"Solo letras, espacios y guiones, sin caracteres especiales"}};filterForm=this.formBuilder.group({createdAt:[""],processType:[""],status:[""],isAproved:[""]});PROCESS_TYPES=[{value:"R",label:"Retencion"},{value:"S",label:"Suspension"}];STATUS=[{value:"accepted",label:"Procesado"},{value:"draft",label:"Registrado"},{value:"rejected",label:"Rechazado"},{value:"sent",label:"Enviado"}];ngOnInit(){this.getData()}onPageChange({rows:i=10,page:e=0}){this.limit.set(i),this.index.set(e),this.getData()}search(i){this.term.set(i),this.index.set(0),this.getData()}create(){this.dialogService.open(k,{header:"Crear Solicitud",maximizable:!0,modal:!0,width:"50vw",breakpoints:{"960px":"75vw","640px":"90vw"}}).onClose.subscribe(e=>{e&&(this.datasource.update(n=>[e,...n].slice(0,this.limit())),this.datasize.update(n=>n+=1))})}update(i){this.dialogService.open(k,{header:"Editar Solicitud",maximizable:!0,modal:!0,width:"50vw",breakpoints:{"960px":"75vw","640px":"90vw"},data:i}).onClose.subscribe(n=>{n&&this.datasource.update(a=>{let s=a.findIndex(({id:T})=>T===n.id);return s===-1?a:(a[s]=n,[...a])})})}showFile(i){this.selectedItem.set(i),this.isShowingFile.set(!0)}showDetail(i){let e={requestId:i.requestId,requestCode:i.requestCode,createdAt:i.createdAt};this.dialogService.open(at,{header:"Detalle Solicitud",data:e,modal:!0,width:"50vw",focusOnShow:!1,closable:!0,breakpoints:{"960px":"75vw","640px":"90vw"}})}filter(){this.index.set(0),this.popoverRef().hide(),this.getData()}resetFilter(){this.filterForm.reset(),this.filter()}onShowOptionsMenu(i){this.menuOptions.set([{label:"Opciones",items:[{icon:"pi pi-pencil",label:"Editar solicitud",disabled:i.status==="draft"||i.status==="rejected",command:()=>{this.update(i)}},{icon:"pi pi-info-circle",label:"Detalle solicitud",command:()=>{this.showDetail(i)}},{icon:"pi pi-download",label:"Descargar datos",command:()=>{this.downloadFile(i)}}]}])}get isFilterFormValid(){return Object.values(this.filterForm.value).some(i=>i!==null)}getData(){this.requestService.findAll(D({limit:this.limit(),offset:this.offset(),term:this.term()},this.filterForm.value)).subscribe(i=>{this.datasource.set(i.requests),this.datasize.set(i.length)})}downloadFile(i){let e=i.dataSheetFile.split(".").pop(),n=`solicitud_remision_${i.requestCode}.${e}`.toLocaleLowerCase();this.fileService.downloadFileFromUrl(i.dataSheetFile,n)}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=q({type:t,selectors:[["app-asfi-fund-tranfer"]],viewQuery:function(e,n){e&1&&_e(n.popoverRef,Qt,5),e&2&&ge()},decls:34,vars:11,consts:[["caption",""],["header",""],["body",""],["emptymessage",""],["op",""],["menu",""],[1,"flex","items-center","justify-between"],[1,"font-medium","text-2xl"],[1,"flex","gap-x-4"],["icon","pi pi-filter",3,"click"],["label","Agregar","icon","pi pi-plus",3,"onClick"],[1,"card","mt-4"],[3,"value","tableStyle"],[1,"flex","justify-end"],[3,"url","visible"],[1,"flex","flex-col","gap-4","w-[25rem]","p-2"],[1,"text-xl"],["icon","pi pi-times",3,"onClick","text"],[3,"formGroup"],[1,"mt-4","flex","flex-col","gap-y-4"],["optionLabel","label","placeholder","Estado del envio","optionValue","value","formControlName","status",1,"w-full",3,"options"],["inputId","icondisplay","styleClass","w-full","placeholder","Fecha creacion","optionValue","value","formControlName","createdAt",1,"w-full",3,"iconDisplay","showIcon"],[1,"flex","justify-end","gap-x-2","mt-4"],["label","Limpiar","severity","secondary",3,"onClick"],["label","Filtrar",3,"onClick","disabled"],["placeholder","Buscar",3,"onSearch"],[2,"width","25%"],[2,"width","4rem"],[1,"text-red-500"],["icon","pi pi-file-pdf","size","small","styleClass","truncate max-w-[350px]",3,"onClick","label","link"],["severity","warn","value","Registrado"],["severity","info","value","Enviado"],["severity","success","value","Procesado"],["severity","danger","value","Rechazado"],["appendTo","body",3,"onShow","popup","model"],["icon","pi pi-ellipsis-v","size","small",3,"onClick","text"],[3,"colSpan"],["currentPageReportTemplate","{first} - {last} de {totalRecords} Registros",3,"onPageChange","rows","first","totalRecords","showCurrentPageReport","showPageLinks","showJumpToPageDropdown"],[3,"visibleChange","url","visible"]],template:function(e,n){if(e&1){let a=x();o(0,"div",6)(1,"span",7),p(2,"Remisiones de Fondos"),r(),o(3,"div",8)(4,"p-button",9),f("click",function(T){c(a);let E=O(19);return u(E.toggle(T))}),r(),o(5,"p-button",10),f("onClick",function(){return c(a),u(n.create())}),r()()(),o(6,"div",11)(7,"p-table",12),g(8,Kt,2,0,"ng-template",null,0,v)(10,Xt,14,0,"ng-template",null,1,v)(12,ai,22,13,"ng-template",null,2,v)(14,li,3,1,"ng-template",null,3,v),r(),g(16,si,2,6,"div",13),r(),g(17,pi,1,2,"asfi-note-display",14),o(18,"p-popover",null,4)(20,"div",15)(21,"div",6)(22,"div",16),p(23,"Filtro avanzado"),r(),o(24,"p-button",17),f("onClick",function(){c(a);let T=O(19);return u(T.hide())}),r()(),o(25,"form",18)(26,"div",19)(27,"div"),C(28,"p-select",20),r(),o(29,"div"),C(30,"p-datepicker",21),r()()(),o(31,"div",22)(32,"p-button",23),f("onClick",function(){return c(a),u(n.resetFilter())}),r(),o(33,"p-button",24),f("onClick",function(){return c(a),u(n.filter())}),r()()()()}e&2&&(l(7),d("value",n.datasource())("tableStyle",y(10,Zt)),l(9),S(n.datasize()>n.limit()?16:-1),l(),S(n.isShowingFile()?17:-1),l(7),d("text",!0),l(),d("formGroup",n.filterForm),l(3),d("options",n.STATUS),l(2),d("iconDisplay","input")("showIcon",!0),l(3),d("disabled",!n.isFilterFormValid))},dependencies:[U,Ce,Z,H,W,$,Y,J,Te,nt,Ze,Qe,X,K,re,j,G,z,oe,ne,tt,et,Ue,Oe,Be,Le,ee,Ne,Xe,Ke,Ie,ot],encapsulation:2,changeDetection:0})};export{se as default};
