import{a as se}from"./chunk-4DE5AXM7.js";import{a as L,b as O}from"./chunk-TTY7FAQP.js";import{b as ae}from"./chunk-WRWHG35S.js";import{a as G,b as R}from"./chunk-3JKGWJ74.js";import{a as A,b as B}from"./chunk-BPMMOJO4.js";import{f as ee,g as te,i as ie,k as oe,o as N}from"./chunk-MBILNKQQ.js";import{f as U}from"./chunk-7VMHK3EI.js";import{E as Y,Va as y,Wa as M,ab as ne,bb as c,db as E,eb as F,hb as k,jb as D,kb as V,lb as P,nb as T,p as X,sb as re,t as w,tb as I}from"./chunk-G3ZQPBPZ.js";import{Cb as f,E as K,Hb as n,Ib as o,Jb as v,Nb as H,Rb as _,S as q,Sb as u,Wa as r,ba as d,bc as s,dc as g,ia as j,ja as $,kb as h,o as J,oa as Q,qb as p,tc as x,uc as W,vc as b,xa as S,xb as m}from"./chunk-LW3WOUBG.js";function ge(i,a){if(i&1&&(n(0,"p-message",7),s(1),x(2,"formErrorMessages"),o()),i&2){let t,e=u();r(),g(" ",b(2,1,(t=e.form.get("asfiUsername"))==null?null:t.errors,e.errorMessages==null?null:e.errorMessages.asfiUsername)," ")}}function Ce(i,a){if(i&1&&(n(0,"p-message",7),s(1),x(2,"formErrorMessages"),o()),i&2){let t,e=u();r(),g(" ",b(2,1,(t=e.form.get("asfiPassword"))==null?null:t.errors,e.errorMessages==null?null:e.errorMessages.asfiPassword)," ")}}function ve(i,a){if(i&1&&(n(0,"p-message",10),s(1),o()),i&2){let t=u();m("life",3e3),r(),g(" ",t.errorMessage()," ")}}var z=class i{formBuilder=d(P);dialogRef=d(te);asfiCredentialsService=d(U);destroyRef=d(Q);data=d(ee).data;hidePassword=!0;form=this.formBuilder.nonNullable.group({asfiUsername:["",[c.required,c.email]],asfiPassword:["",[c.required,c.minLength(4)]]});errorMessage=S(null);isSaveButtonEnabled=S(!0);messageTrigger$=new J;errorMessages={asfiUsername:{email:"Ingrese un correo electr\xF3nico v\xE1lido"},asfiPassword:{required:"La contrase\xF1a es requerida"}};ngOnInit(){this.messageTrigger$.pipe(q(()=>K(3e3)),oe(this.destroyRef)).subscribe(()=>{this.errorMessage.set(null),this.isSaveButtonEnabled.set(!0)})}showMessage(a){this.errorMessage.set(a),this.messageTrigger$.next()}save(){this.isSaveButtonEnabled.set(!1);let{asfiUsername:a,asfiPassword:t}=this.form.value;this.asfiCredentialsService.validateCredentials(a,t).pipe(q(()=>this.asfiCredentialsService.setCredentials(a,t))).subscribe({next:()=>{this.dialogRef.close()},error:e=>{e instanceof Y&&this.showMessage(e.status===401?"Usuario o contrase\xF1a incorrectos":"No se pudo actualizar sus credenciales")}})}close(){this.dialogRef.close()}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=h({type:i,selectors:[["app-asfi-credentials-dialog"]],decls:26,vars:7,consts:[[1,"p-dialog-content"],[1,"mt-5",3,"formGroup"],[1,"flex","flex-col","justify-center","gap-y-8"],[1,"flex","items-center","gap-x-6","mb-4"],[1,"pi","pi-shield",2,"font-size","2.5rem"],[1,"font-bold","text-lg"],["pInputText","","formControlName","asfiUsername",1,"w-full"],["severity","error","variant","simple","size","small","styleClass","mt-2 px-2"],[1,"w-full"],["formControlName","asfiPassword","autocomplete","off","inputStyleClass","w-full","styleClass","w-full",3,"feedback","toggleMask"],["severity","error",3,"life"],[1,"text-md","font-extralight"],[1,"p-dialog-footer"],["label","Cancelar","severity","danger","variant","outlined",3,"onClick"],["label","Guardar",3,"onClick","disabled"]],template:function(t,e){if(t&1&&(n(0,"div",0)(1,"form",1)(2,"div",2)(3,"div",3)(4,"div"),v(5,"i",4),o(),n(6,"div",5),s(7," Ingrese el usuario y contrase\xF1a proporcionados por la ASFI para habilitar la comunicaci\xF3n con los servicios web del sistema (SIREFO) "),o()(),n(8,"div")(9,"p-floatlabel"),v(10,"input",6),n(11,"label"),s(12,"Usuario"),o()(),p(13,ge,3,4,"p-message",7),o(),n(14,"div")(15,"p-floatlabel",8),v(16,"p-password",9),n(17,"label"),s(18,"Contrase\xF1a"),o()(),p(19,Ce,3,4,"p-message",7),o(),p(20,ve,2,2,"p-message",10),n(21,"div",11),s(22," Sus credenciales ser\xE1n almacenadas de forma segura y solo se utilizar\xE1n para la comunicaci\xF3n con ASFI. "),o()()()(),n(23,"div",12)(24,"p-button",13),_("onClick",function(){return e.close()}),o(),n(25,"p-button",14),_("onClick",function(){return e.save()}),o()()),t&2){let l,C;r(),m("formGroup",e.form),r(12),f((l=e.form.get("asfiUsername"))!=null&&l.hasError&&((l=e.form.get("asfiUsername"))!=null&&l.touched)?13:-1),r(3),m("feedback",!1)("toggleMask",!0),r(3),f((C=e.form.get("asfiPassword"))!=null&&C.hasError&&((C=e.form.get("asfiPassword"))!=null&&C.touched)?19:-1),r(),f(e.errorMessage()?20:-1),r(5),m("disabled",!e.isSaveButtonEnabled())}},dependencies:[w,T,k,ne,E,F,D,V,B,A,I,re,R,G,O,L,M,y,N],encapsulation:2,changeDetection:0})};function _e(i,a){if(i&1&&(n(0,"p-message",14),s(1),x(2,"formErrorMessages"),o()),i&2){let t,e=u();r(),g(" ",b(2,1,(t=e.formUser.get("password"))==null?null:t.errors,e.errorMessages==null?null:e.errorMessages.password)," ")}}function xe(i,a){if(i&1&&(n(0,"p-message",14),s(1),x(2,"formErrorMessages"),o()),i&2){let t,e=u(2);r(),g(" ",b(2,1,(t=e.formUser.get("confirmPassword"))==null?null:t.errors,e.errorMessages==null?null:e.errorMessages.confirmPassword)," ")}}function be(i,a){if(i&1&&(n(0,"div")(1,"p-floatlabel",12),v(2,"p-password",17),n(3,"label"),s(4,"Confirmar contrase\xF1a"),o()(),p(5,xe,3,4,"p-message",14),o()),i&2){let t,e=u();r(2),m("feedback",!1)("toggleMask",!0),r(3),f((t=e.formUser.get("confirmPassword"))!=null&&t.hasError&&((t=e.formUser.get("confirmPassword"))!=null&&t.touched)?5:-1)}}function Se(i,a){if(i&1){let t=H();n(0,"p-button",21),_("onClick",function(){j(t);let l=u(2);return $(l.openAsfiCrendentials())}),o()}i&2&&m("rounded",!0)}function he(i,a){if(i&1){let t=H();n(0,"p-button",22),_("onClick",function(){j(t);let l=u(2);return $(l.openAsfiCrendentials())}),o()}i&2&&m("rounded",!0)}function we(i,a){if(i&1&&(n(0,"div",7)(1,"dt",8),s(2,"Verficacion (ASFI)"),o(),n(3,"dd",18),p(4,Se,1,1,"p-button",19)(5,he,1,1,"p-button",20),o()()),i&2){let t=u();r(4),f(t.isVerified()?4:5)}}function ye(i,a){i&1&&(n(0,"div",15)(1,"p-message",23),s(2,"Cambios guardados"),o()()),i&2&&(r(),m("life",3e3))}var Z=class i{dialogService=d(ie);authService=d(ae);asfiCredentialsService=d(U);_formBuilder=d(P);isEmployee=this.authService.roles().includes("employee");isVerified=this.asfiCredentialsService.email;fullName=this.authService.user()?.fullName;formUser=this._formBuilder.nonNullable.group({password:["",[c.minLength(8),c.pattern("^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d).+$")]],confirmPassword:["",c.required]},{validators:se.matchFields("password","confirmPassword")});visible=S(!1);errorMessages={password:{pattern:"Ingrese al menos una letra min\xFAscula, una may\xFAscula y un n\xFAmero"},confirmPassword:{not_match:"Las contrase\xF1as no coinciden"}};ngOnInit(){this.checkVefification()}save(){let{password:a}=this.formUser.value;this.authService.updateMyUser(a).subscribe(()=>{this.showMessage()})}openAsfiCrendentials(){this.dialogService.open(z,{header:"Verificar Credenciales",modal:!0,width:"30vw",breakpoints:{"960px":"75vw","640px":"90vw"}})}checkVefification(){this.isEmployee&&(this.isVerified()||this.openAsfiCrendentials())}showMessage(){this.visible.set(!0),setTimeout(()=>{this.visible.set(!1)},3300)}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=h({type:i,selectors:[["app-settings"]],decls:30,vars:11,consts:[[1,"mx-auto","max-w-4xl","py-4"],[1,"px-4","sm:px-0"],[1,"text-base/7","font-semibold"],[1,"mt-1","max-w-2xl","text-md"],[1,"mt-6","border-t","border-gray-200","mb-4"],[3,"formGroup"],[1,"divide-y","divide-gray-200"],[1,"px-4","py-6","sm:grid","sm:grid-cols-3","sm:gap-4","sm:px-0"],[1,"text-md","font-medium"],[1,"mt-1","text-md","sm:col-span-2","sm:mt-0"],[1,"mt-1","sm:col-span-2","sm:mt-0","space-y-4","sm:max-w-[500px]"],[1,"flex","flex-col","gap-y-8"],[1,"w-full","sm:w-96"],["formControlName","password","autocomplete","false","inputStyleClass","w-full","styleClass","w-full",3,"feedback","toggleMask"],["severity","error","variant","simple","size","small","styleClass","mt-2 px-2"],[1,"mb-6"],["label","Guardar",3,"onClick","disabled"],["formControlName","confirmPassword","autocomplete","false","inputStyleClass","w-full","styleClass","w-full",3,"feedback","toggleMask"],[1,"mt-1","sm:col-span-2","sm:mt-0"],["label","Verificado","severity","success","icon","pi pi-shield",3,"rounded"],["label","Verificar","severity","danger","icon","pi pi-shield",3,"rounded"],["label","Verificado","severity","success","icon","pi pi-shield",3,"onClick","rounded"],["label","Verificar","severity","danger","icon","pi pi-shield",3,"onClick","rounded"],["severity","success",3,"life"]],template:function(t,e){if(t&1&&(n(0,"div",0)(1,"div",1)(2,"h3",2),s(3,"Configuracion del usuario"),o(),n(4,"p",3),s(5,"Cambie su datos de acceso"),o()(),n(6,"div",4)(7,"form",5)(8,"dl",6)(9,"div",7)(10,"dt",8),s(11,"Nombre"),o(),n(12,"dd",9),s(13),x(14,"titlecase"),o()(),n(15,"div",7)(16,"dt",8),s(17,"Contrase\xF1a"),o(),n(18,"dd",10)(19,"div",11)(20,"div")(21,"p-floatlabel",12),v(22,"p-password",13),n(23,"label"),s(24,"Contrase\xF1a"),o()(),p(25,_e,3,4,"p-message",14),o(),p(26,be,6,3,"div"),o()()(),p(27,we,6,1,"div",7),o()()(),p(28,ye,3,1,"div",15),n(29,"p-button",16),_("onClick",function(){return e.save()}),o()()),t&2){let l,C;r(7),m("formGroup",e.formUser),r(6),g(" ",W(14,9,e.fullName)," "),r(9),m("feedback",!1)("toggleMask",!0),r(3),f((l=e.formUser.get("password"))!=null&&l.hasError&&((l=e.formUser.get("password"))!=null&&l.touched)?25:-1),r(),f((C=e.formUser.get("password"))!=null&&C.value?26:-1),r(),f(e.isEmployee?27:-1),r(),f(e.visible()?28:-1),r(),m("disabled",e.formUser.invalid)}},dependencies:[T,k,E,F,D,V,w,X,I,M,y,R,G,B,A,O,L,N],encapsulation:2,changeDetection:0})};export{Z as default};
