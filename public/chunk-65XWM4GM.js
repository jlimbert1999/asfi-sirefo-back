import{a as L,b as O}from"./chunk-6SSC7OSL.js";import{b as de}from"./chunk-6ODDCBFD.js";import{a as G,b as R}from"./chunk-LRCJSLKM.js";import{a as U,b as B}from"./chunk-T7MFMHRL.js";import{f as re,g as ne,i as se,k as ae,n as N}from"./chunk-Y7MSNO74.js";import{f as A}from"./chunk-2NLAH6WF.js";import{$a as y,E as oe,ab as E,gb as le,hb as g,jb as M,kb as F,nb as k,p as ie,pb as D,qb as V,rb as P,t as w,tb as T,yb as me,zb as I}from"./chunk-XYURQZTM.js";import{Cb as u,E as Y,Hb as r,Ib as o,Jb as v,Nb as Z,Rb as _,S as j,Sb as f,Wa as n,a as Q,b as W,ba as p,bc as a,dc as C,ia as $,ja as H,kb as h,o as X,oa as ee,qb as c,tc as x,uc as te,vc as b,xa as S,xb as d}from"./chunk-LW3WOUBG.js";function _e(i,s){if(i&1&&(r(0,"p-message",7),a(1),x(2,"formErrorMessages"),o()),i&2){let t,e=f();n(),C(" ",b(2,1,(t=e.form.get("asfiUsername"))==null?null:t.errors,e.errorMessages==null?null:e.errorMessages.asfiUsername)," ")}}function xe(i,s){if(i&1&&(r(0,"p-message",7),a(1),x(2,"formErrorMessages"),o()),i&2){let t,e=f();n(),C(" ",b(2,1,(t=e.form.get("asfiPassword"))==null?null:t.errors,e.errorMessages==null?null:e.errorMessages.asfiPassword)," ")}}function be(i,s){if(i&1&&(r(0,"p-message",10),a(1),o()),i&2){let t=f();d("life",3e3),n(),C(" ",t.errorMessage()," ")}}var q=class i{formBuilder=p(P);dialogRef=p(ne);asfiCredentialsService=p(A);destroyRef=p(ee);data=p(re).data;hidePassword=!0;form=this.formBuilder.nonNullable.group({asfiUsername:["",[g.required,g.email]],asfiPassword:["",[g.required,g.minLength(4)]]});errorMessage=S(null);isSaveButtonEnabled=S(!0);messageTrigger$=new X;errorMessages={asfiUsername:{email:"Ingrese un correo electr\xF3nico v\xE1lido"},asfiPassword:{required:"La contrase\xF1a es requerida"}};ngOnInit(){this.messageTrigger$.pipe(j(()=>Y(3e3)),ae(this.destroyRef)).subscribe(()=>{this.errorMessage.set(null),this.isSaveButtonEnabled.set(!0)})}showMessage(){this.errorMessage.set("Usuario o contrase\xF1a incorrectos"),this.messageTrigger$.next()}save(){this.isSaveButtonEnabled.set(!1);let{asfiUsername:s,asfiPassword:t}=this.form.value;this.asfiCredentialsService.validateCredentials(s,t).pipe(j(()=>this.asfiCredentialsService.setCredentials(s,t))).subscribe({next:()=>{this.dialogRef.close()},error:e=>{e instanceof oe&&e.status===401&&this.showMessage()}})}close(){this.dialogRef.close()}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=h({type:i,selectors:[["app-asfi-credentials-dialog"]],decls:26,vars:7,consts:[[1,"p-dialog-content"],[1,"mt-5",3,"formGroup"],[1,"flex","flex-col","justify-center","gap-y-8"],[1,"flex","items-center","gap-x-6","mb-4"],[1,"pi","pi-shield",2,"font-size","2.5rem"],[1,"font-bold","text-lg"],["pInputText","","formControlName","asfiUsername",1,"w-full"],["severity","error","variant","simple","size","small","styleClass","mt-2 px-2"],[1,"w-full"],["formControlName","asfiPassword","autocomplete","off","inputStyleClass","w-full","styleClass","w-full",3,"feedback","toggleMask"],["severity","error",3,"life"],[1,"text-md","font-extralight"],[1,"p-dialog-footer"],["label","Cancelar","severity","danger","variant","outlined",3,"onClick"],["label","Guardar",3,"onClick","disabled"]],template:function(t,e){if(t&1&&(r(0,"div",0)(1,"form",1)(2,"div",2)(3,"div",3)(4,"div"),v(5,"i",4),o(),r(6,"div",5),a(7," Ingrese el usuario y contrase\xF1a proporcionados por la ASFI para habilitar la comunicaci\xF3n con los servicios web del sistema (SIREFO) "),o()(),r(8,"div")(9,"p-floatlabel"),v(10,"input",6),r(11,"label"),a(12,"Usuario"),o()(),c(13,_e,3,4,"p-message",7),o(),r(14,"div")(15,"p-floatlabel",8),v(16,"p-password",9),r(17,"label"),a(18,"Contrase\xF1a"),o()(),c(19,xe,3,4,"p-message",7),o(),c(20,be,2,2,"p-message",10),r(21,"div",11),a(22," Sus credenciales ser\xE1n almacenadas de forma segura y solo se utilizar\xE1n para la comunicaci\xF3n con ASFI. "),o()()()(),r(23,"div",12)(24,"p-button",13),_("onClick",function(){return e.close()}),o(),r(25,"p-button",14),_("onClick",function(){return e.save()}),o()()),t&2){let l,m;n(),d("formGroup",e.form),n(12),u((l=e.form.get("asfiUsername"))!=null&&l.hasError&&((l=e.form.get("asfiUsername"))!=null&&l.touched)?13:-1),n(3),d("feedback",!1)("toggleMask",!0),n(3),u((m=e.form.get("asfiPassword"))!=null&&m.hasError&&((m=e.form.get("asfiPassword"))!=null&&m.touched)?19:-1),n(),u(e.errorMessage()?20:-1),n(5),d("disabled",!e.isSaveButtonEnabled())}},dependencies:[w,T,k,le,M,F,D,V,B,U,I,me,R,G,O,L,E,y,N],encapsulation:2,changeDetection:0})};var z=class{static matchFields(s,t){return e=>{let l=e.get(s),m=e.get(t);if(!l||!m)return null;let K=m.errors;return Se(l.value,m.value)?(m.setErrors(W(Q({},K),{not_match:!0})),{not_match:!0}):(m?.setErrors(K),null)}}};function Se(i,s){return i!==s&&s!==""}function he(i,s){if(i&1&&(r(0,"p-message",14),a(1),x(2,"formErrorMessages"),o()),i&2){let t,e=f();n(),C(" ",b(2,1,(t=e.formUser.get("password"))==null?null:t.errors,e.errorMessages==null?null:e.errorMessages.password)," ")}}function we(i,s){if(i&1&&(r(0,"p-message",14),a(1),x(2,"formErrorMessages"),o()),i&2){let t,e=f(2);n(),C(" ",b(2,1,(t=e.formUser.get("confirmPassword"))==null?null:t.errors,e.errorMessages==null?null:e.errorMessages.confirmPassword)," ")}}function ye(i,s){if(i&1&&(r(0,"div")(1,"p-floatlabel",12),v(2,"p-password",17),r(3,"label"),a(4,"Confirmar contrase\xF1a"),o()(),c(5,we,3,4,"p-message",14),o()),i&2){let t,e=f();n(2),d("feedback",!1)("toggleMask",!0),n(3),u((t=e.formUser.get("confirmPassword"))!=null&&t.hasError&&((t=e.formUser.get("confirmPassword"))!=null&&t.touched)?5:-1)}}function Ee(i,s){if(i&1){let t=Z();r(0,"p-button",21),_("onClick",function(){$(t);let l=f(2);return H(l.openAsfiCrendentials())}),o()}i&2&&d("rounded",!0)}function Me(i,s){if(i&1){let t=Z();r(0,"p-button",22),_("onClick",function(){$(t);let l=f(2);return H(l.openAsfiCrendentials())}),o()}i&2&&d("rounded",!0)}function Fe(i,s){if(i&1&&(r(0,"div",7)(1,"dt",8),a(2,"Verficacion (ASFI)"),o(),r(3,"dd",18),c(4,Ee,1,1,"p-button",19)(5,Me,1,1,"p-button",20),o()()),i&2){let t=f();n(4),u(t.isVerified()?4:5)}}function ke(i,s){i&1&&(r(0,"div",15)(1,"p-message",23),a(2,"Cambios guardados"),o()()),i&2&&(n(),d("life",3e3))}var J=class i{dialogService=p(se);authService=p(de);asfiCredentialsService=p(A);_formBuilder=p(P);isEmployee=this.authService.roles().includes("employee");isVerified=this.asfiCredentialsService.email;fullName=this.authService.user()?.fullName;formUser=this._formBuilder.nonNullable.group({password:["",[g.minLength(8),g.pattern("^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d).+$")]],confirmPassword:["",g.required]},{validators:z.matchFields("password","confirmPassword")});visible=S(!1);errorMessages={password:{pattern:"Ingrese al menos una letra min\xFAscula, una may\xFAscula y un n\xFAmero"},confirmPassword:{not_match:"Las contrase\xF1as no coinciden"}};ngOnInit(){this.checkVefification()}save(){let{password:s}=this.formUser.value;this.authService.updateMyUser(s).subscribe(()=>{this.showMessage()})}openAsfiCrendentials(){this.dialogService.open(q,{header:"Verificar Credenciales",modal:!0,width:"30vw",breakpoints:{"960px":"75vw","640px":"90vw"}})}checkVefification(){this.isEmployee&&(this.isVerified()||this.openAsfiCrendentials())}showMessage(){this.visible.set(!0),setTimeout(()=>{this.visible.set(!1)},3300)}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=h({type:i,selectors:[["app-settings"]],decls:30,vars:11,consts:[[1,"mx-auto","max-w-4xl","py-4"],[1,"px-4","sm:px-0"],[1,"text-base/7","font-semibold"],[1,"mt-1","max-w-2xl","text-md"],[1,"mt-6","border-t","border-gray-200","mb-4"],[3,"formGroup"],[1,"divide-y","divide-gray-200"],[1,"px-4","py-6","sm:grid","sm:grid-cols-3","sm:gap-4","sm:px-0"],[1,"text-md","font-medium"],[1,"mt-1","text-md","sm:col-span-2","sm:mt-0"],[1,"mt-1","sm:col-span-2","sm:mt-0","space-y-4","sm:max-w-[500px]"],[1,"flex","flex-col","gap-y-8"],[1,"w-full","sm:w-96"],["formControlName","password","autocomplete","false","inputStyleClass","w-full","styleClass","w-full",3,"feedback","toggleMask"],["severity","error","variant","simple","size","small","styleClass","mt-2 px-2"],[1,"mb-6"],["label","Guardar",3,"onClick","disabled"],["formControlName","confirmPassword","autocomplete","false","inputStyleClass","w-full","styleClass","w-full",3,"feedback","toggleMask"],[1,"mt-1","sm:col-span-2","sm:mt-0"],["label","Verificado","severity","success","icon","pi pi-shield",3,"rounded"],["label","Verificar","severity","danger","icon","pi pi-shield",3,"rounded"],["label","Verificado","severity","success","icon","pi pi-shield",3,"onClick","rounded"],["label","Verificar","severity","danger","icon","pi pi-shield",3,"onClick","rounded"],["severity","success",3,"life"]],template:function(t,e){if(t&1&&(r(0,"div",0)(1,"div",1)(2,"h3",2),a(3,"Configuracion del usuario"),o(),r(4,"p",3),a(5,"Cambie su datos de acceso"),o()(),r(6,"div",4)(7,"form",5)(8,"dl",6)(9,"div",7)(10,"dt",8),a(11,"Nombre"),o(),r(12,"dd",9),a(13),x(14,"titlecase"),o()(),r(15,"div",7)(16,"dt",8),a(17,"Contrase\xF1a"),o(),r(18,"dd",10)(19,"div",11)(20,"div")(21,"p-floatlabel",12),v(22,"p-password",13),r(23,"label"),a(24,"Contrase\xF1a"),o()(),c(25,he,3,4,"p-message",14),o(),c(26,ye,6,3,"div"),o()()(),c(27,Fe,6,1,"div",7),o()()(),c(28,ke,3,1,"div",15),r(29,"p-button",16),_("onClick",function(){return e.save()}),o()()),t&2){let l,m;n(7),d("formGroup",e.formUser),n(6),C(" ",te(14,9,e.fullName)," "),n(9),d("feedback",!1)("toggleMask",!0),n(3),u((l=e.formUser.get("password"))!=null&&l.hasError&&((l=e.formUser.get("password"))!=null&&l.touched)?25:-1),n(),u((m=e.formUser.get("password"))!=null&&m.value?26:-1),n(),u(e.isEmployee?27:-1),n(),u(e.visible()?28:-1),n(),d("disabled",e.formUser.invalid)}},dependencies:[T,k,M,F,D,V,w,ie,I,E,y,R,G,B,U,O,L,N],encapsulation:2,changeDetection:0})};export{J as default};
