import{a as Ke,b as re,c as Xe,d as et,e as tt,f as it,g as ot,h as nt,i as rt,j as at,k as lt,l as st,m as pt,n as mt,o as ct,p as ut,q as dt,r as ft}from"./chunk-4I2BN4NF.js";import{b as _t}from"./chunk-CJP7H7V5.js";import{a as Ie,b as ke}from"./chunk-XYLEAZTU.js";import{a as Ge}from"./chunk-4DE5AXM7.js";import{a as Ue,b as ze}from"./chunk-TTY7FAQP.js";import{b as Ne}from"./chunk-WRWHG35S.js";import{a as Qe,b as Ze}from"./chunk-YIPVTPHC.js";import"./chunk-BE2INV4N.js";import{a as Pe,b as Le}from"./chunk-YYO54SXT.js";import"./chunk-R3IN7URU.js";import{a as Be}from"./chunk-BPMMOJO4.js";import{d as Se,e as G,f as be,g as we,h as ye,i as Re,j as De,n as Ve,o as Me}from"./chunk-MBILNKQQ.js";import{b as je,c as We,d as $e,e as Ye,f as He,g as Je,h as oe,i as ne}from"./chunk-52TP4QYS.js";import"./chunk-UPP2M2S6.js";import{b as Oe,d as te,e as ie}from"./chunk-7VMHK3EI.js";import{Ab as ee,E as xe,Va as U,Wa as z,ab as Ee,bb as b,db as j,eb as W,hb as $,jb as Y,kb as H,lb as J,nb as Q,pb as Z,r as Ce,rb as K,sb as qe,t as B,tb as Te,va as ve,xb as Fe,yb as Ae,zb as X}from"./chunk-G3ZQPBPZ.js";import{$b as ge,Ab as fe,C as me,Cb as S,Db as k,Fb as P,G as ce,Gb as L,Hb as n,Hc as he,Ib as r,Jb as g,Nb as x,Rb as f,S as ae,Sb as c,Wa as l,_b as _e,a as D,ac as O,b as se,ba as C,bc as p,c as pe,cb as ue,cc as y,dc as E,fc as q,gc as T,hc as F,ia as u,ja as d,jc as R,kb as I,qb as h,s as N,tc as A,vc as V,wc as v,xa as _,xb as m,yb as de}from"./chunk-LW3WOUBG.js";var wt=()=>({severity:"secondary"}),yt=()=>({"min-width":"75rem"}),Rt=()=>["documentNumber","firstName","paternalLastName","maternalLastName"],Dt=()=>({width:"40rem"}),Et=()=>({"1199px":"75vw","575px":"90vw"});function qt(t,i){if(t&1&&(n(0,"p-message",18),p(1),A(2,"formErrorMessages"),r()),t&2){let e,o=c(2);l(),E(" ",V(2,1,(e=o.form.get("requestingAuthority"))==null?null:e.errors,o.formMessages==null?null:o.formMessages.requestingAuthority)," ")}}function Tt(t,i){if(t&1&&(n(0,"p-message",18),p(1),A(2,"formErrorMessages"),r()),t&2){let e,o=c(2);l(),E(" ",V(2,1,(e=o.form.get("authorityPosition"))==null?null:e.errors,o.formMessages==null?null:o.formMessages.authorityPosition)," ")}}function Ft(t,i){if(t&1&&(n(0,"div",30),g(1,"i",33),n(2,"span",34),p(3),r()()),t&2){let e=c(2);l(3),y(e.pdfFileName())}}function At(t,i){t&1&&(n(0,"span"),p(1,"Nota de solicitud dirigida a ASFI - (PDF)"),r())}function Vt(t,i){if(t&1){let e=x();n(0,"form",14)(1,"div",15)(2,"div",16)(3,"p-floatlabel"),g(4,"input",17),n(5,"label"),p(6,"Nombre Autoridad Solicitante"),r()(),h(7,qt,3,4,"p-message",18),r(),n(8,"div",16)(9,"p-floatlabel"),g(10,"input",19),n(11,"label"),p(12,"Cargo Autoridad Solicitante"),r()(),h(13,Tt,3,4,"p-message",18),r(),n(14,"div")(15,"p-inputgroup")(16,"p-inputgroup-addon",20),p(17," CE/SF-DRT-72 "),r(),n(18,"p-floatlabel",21),g(19,"p-inputnumber",22),n(20,"label"),p(21,"Nro. Cite"),r()(),n(22,"p-inputgroup-addon",23),p(23),r()()(),n(24,"div"),g(25,"p-select",24),r(),n(26,"div",25)(27,"p-floatlabel"),g(28,"input",26),n(29,"label"),p(30,"Gerencia Solicitante"),r()()(),n(31,"div",27)(32,"div",28)(33,"p-fileupload",29),f("onSelect",function(a){u(e);let s=c();return d(s.onPdfSelect(a))}),r(),n(34,"div"),h(35,Ft,4,1,"div",30)(36,At,2,0,"span"),r()()()()(),n(37,"div",31)(38,"p-button",32),f("onClick",function(){let a=u(e).activateCallback;return d(a(2))}),r()()}if(t&2){let e,o,a=c();m("formGroup",a.form),l(7),S((e=a.form.get("requestingAuthority"))!=null&&e.hasError&&((e=a.form.get("requestingAuthority"))!=null&&e.touched)?7:-1),l(6),S((o=a.form.get("authorityPosition"))!=null&&o.hasError&&((o=a.form.get("authorityPosition"))!=null&&o.touched)?13:-1),l(6),m("useGrouping",!1)("min",1)("max",99999),l(4),E(" ",a.YEAR," "),l(2),m("options",a.PROCESS_TYPES),l(10),S(a.pdfFileName()?35:36)}}function Mt(t,i){if(t&1){let e=x();n(0,"p-button",40),f("onClick",function(){u(e);let a=c(2);return d(a.datasource.set([]))}),r()}if(t&2){let e=c(2);m("disabled",e.datasource().length===0)}}function Nt(t,i){if(t&1){let e=x();n(0,"div",41)(1,"p-button",42),f("onClick",function(){u(e);let a=c(2);return d(a.isInfoDialogShowing.set(!0))}),r(),n(2,"a",43),g(3,"i",44),r(),n(4,"p-fileUpload",45),f("onSelect",function(a){u(e);let s=c(2);return d(s.onSpreadSheetSelect(a))}),r()()}t&2&&(l(4),m("chooseButtonProps",R(1,wt)))}function It(t,i){if(t&1&&(n(0,"th")(1,"div",47),p(2),r()()),t&2){let e,o=i.$implicit;de("min-width",(e=o.width)!==null&&e!==void 0?e:"15rem"),l(2),y(o.header)}}function kt(t,i){if(t&1&&(n(0,"tr"),P(1,It,3,3,"th",46,k),r()),t&2){let e=c(3);l(),L(e.COLUMNS)}}function Pt(t,i){if(t&1&&(n(0,"td"),p(1),r()),t&2){let e=i.$implicit,o=c().$implicit;l(),y(o[e.columnDef])}}function Lt(t,i){if(t&1&&(n(0,"tr"),P(1,Pt,2,1,"td",null,k),r()),t&2){let e=c(3);l(),L(e.COLUMNS)}}function Ot(t,i){if(t&1&&(n(0,"tr")(1,"td",48),p(2,"Sin registros"),r()()),t&2){let e=c(3);l(),m("colSpan",e.COLUMNS.length)}}function Bt(t,i){if(t&1&&(n(0,"p-table",36,3),h(2,kt,3,0,"ng-template",null,4,v)(4,Lt,3,0,"ng-template",null,5,v)(6,Ot,3,1,"ng-template",null,6,v),r()),t&2){let e=c(2);m("value",e.datasource())("rows",8)("paginator",!0)("showCurrentPageReport",!0)("tableStyle",R(7,yt))("alwaysShowPaginator",e.datasource().length>5)("globalFilterFields",R(8,Rt))}}function Ut(t,i){t&1&&(n(0,"div",37),p(1," No hay personas registradas en la solicitud "),r())}function zt(t,i){if(t&1){let e=x();n(0,"p-toolbar",35),h(1,Mt,1,1,"ng-template",null,1,v)(3,Nt,5,2,"ng-template",null,2,v),r(),h(5,Bt,8,9,"p-table",36)(6,Ut,2,0,"div",37),n(7,"div",38)(8,"p-button",39),f("onClick",function(){let a=u(e).activateCallback;return d(a(1))}),r()()}if(t&2){let e=c();l(5),S(e.datasource().length>0?5:6)}}function Gt(t,i){if(t&1&&(n(0,"p"),p(1),r()),t&2){let e=i.$implicit;l(),y(e)}}function jt(t,i){if(t&1){let e=x();n(0,"p-dialog",49),F("visibleChange",function(a){u(e);let s=c();return T(s.isErrorDialogShowing,a)||(s.isErrorDialogShowing=a),d(a)}),P(1,Gt,2,1,"p",null,k),r()}if(t&2){let e=c();fe(R(6,Dt)),m("modal",!0)("draggable",!1),q("visible",e.isErrorDialogShowing),m("breakpoints",R(7,Et)),l(),L(e.errorMessages())}}function Wt(t,i){if(t&1){let e=x();n(0,"data-format-dialog",50),F("isVisibleChange",function(a){u(e);let s=c();return T(s.isInfoDialogShowing,a)||(s.isInfoDialogShowing=a),d(a)}),r()}if(t&2){let e=c();q("isVisible",e.isInfoDialogShowing)}}var M=class t{formBuilder=C(J);excelService=C(Oe);dialogRef=C(we);alertService=C(De);asfiRequestService=C(te);fileUploadService=C(ie);messageService=C(ve);user=C(Ne).user();data=C(be).data;YEAR=new Date().getFullYear();COLUMNS=[{header:"Item",columnDef:"item",width:"40px"},{header:"Nombres",columnDef:"firstName",width:"15rem"},{header:"Apellido Paterno",columnDef:"paternalLastName"},{header:"Apellido Materno",columnDef:"maternalLastName"},{header:"Tipo Documento",columnDef:"documentType"},{header:"Numero Documento",columnDef:"documentNumber"},{header:"Complemento",columnDef:"complement"},{header:"Extension",columnDef:"extension",width:"100px"},{header:"Auto Conclusion",columnDef:"autoConclusion"},{header:"Documento Respaldo",columnDef:"supportDocument"},{header:"Razon Social",columnDef:"businessName"},{header:"Monto",columnDef:"amount"},{header:"Tipo Respaldo",columnDef:"supportType"}];PROCESS_TYPES=[{value:"R",label:"Retenci\xF3n"},{value:"S",label:"Suspensi\xF3n"}];form=this.formBuilder.nonNullable.group({requestingAuthority:[this.user?.fullName,[b.required,b.minLength(5),b.pattern(/^[A-Za-zÁÉÍÓÚÑáéíóúñ' -]+$/),Ge.minWordsValidator(2)]],authorityPosition:[this.user?.position,[b.required,b.minLength(4),b.pattern(/^[A-Za-zÁÉÍÓÚÑáéíóúñ.\- ]+$/)]],requestCode:["",[b.required,b.min(1),b.max(99999)]],department:["",b.required],processType:["",b.required]});formMessages={requestingAuthority:{pattern:"Solo letras, espacios y guiones, sin caracteres especiales",minWords:"Se requieren al menos 2 palabras"},authorityPosition:{pattern:"Solo letras, espacios y guiones, sin caracteres especiales"}};datasource=_([]);errorMessages=_([]);pdfFile=_(null);pdfFileName=_(null);spreadsheetFile=_(null);isDatasourceLoading=_(!1);isErrorDialogShowing=_(!1);isInfoDialogShowing=_(!1);ngOnInit(){this.loadFormData()}save(){if(!this.isFormValid)return;this.buildSaveMethod().subscribe({next:e=>{this.dialogRef.close(e)},error:e=>{e instanceof xe&&this.handleHtttErrrors(e)}})}onPdfSelect(i){let[e]=i.files;e&&e.type!=="application/pdf"||(this.pdfFile.set(e),this.pdfFileName.set(e.name))}onSpreadSheetSelect(i){let[e]=i.files;if(!e)return;this.spreadsheetFile.set(e);let o=this.COLUMNS.map(({header:a})=>a);this.excelService.readExcelFile(e,o).subscribe({next:a=>{this.datasource.set(this.excelDataToDto(a))},error:()=>{this.messageService.add({severity:"warn",summary:"Formato incorrecto",detail:"No se puedo cargar el archivo"})}})}close(){this.dialogRef.close()}get isFormValid(){return this.data?this.form.valid&&this.datasource().length>0:this.form.valid&&this.datasource().length>0&&this.pdfFile()&&this.spreadsheetFile()}handleHtttErrrors(i){let{message:e}=i.error;switch(i.status){case 409:let o=i.error.request;this.alertService.message({header:"Error al registrar la solicitud",description:typeof e=="string"?e:"La solicitud es invalida"}),this.dialogRef.close(o);break;case 400:Array.isArray(e)&&(this.errorMessages.set(this.parseValidationErrors(e)),this.isErrorDialogShowing.set(!0));break;default:break}}loadFormData(){if(!this.data)return;let s=this.data,{file:i,dataSheetFile:e,requestCode:o}=s,a=pe(s,["file","dataSheetFile","requestCode"]);this.form.patchValue(se(D({},a),{requestCode:this.data.extractCorrelative().toString()})),this.pdfFileName.set(i.originalName),this.fileUploadService.getFile(e).pipe(ae(w=>this.excelService.readExcelFile(w)),ce(()=>N([]))).subscribe(w=>{this.datasource.set(this.excelDataToDto(w))})}excelDataToDto(i){return i.map(e=>({item:e.Item.toString(),maternalLastName:e["Apellido Materno"],paternalLastName:e["Apellido Paterno"],autoConclusion:e["Auto Conclusion"],complement:e["Tipo Documento"],extension:e.Extension,documentNumber:e["Numero Documento"],documentType:e["Tipo Documento"],supportDocument:e["Documento Respaldo"],amount:e.Monto,firstName:e.Nombres,businessName:e["Razon Social"],supportType:e["Tipo Respaldo"]}))}buildSaveMethod(){return me([this.pdfFile()?this.fileUploadService.uploadAsfiFile(this.pdfFile()):N(null),this.spreadsheetFile()?this.fileUploadService.uploadAsfiFile(this.spreadsheetFile()):N(null)]).pipe(ae(([i,e])=>{let o=D(D(D({},this.form.value),i&&{file:i}),e&&{dataSheetFile:e.fileName});return this.data?this.asfiRequestService.update(this.data.id,o,this.datasource()):this.asfiRequestService.create(o,this.datasource())}))}parseValidationErrors(i){return i.map(e=>{let o=e.split(".",3);if(o.length<=2)return o.join(".");let a=parseInt(o[1],10),s=o.slice(2).join(".");return`Fila ${a+1}: ${s.trim()}`})}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=I({type:t,selectors:[["app-request-dialog"]],decls:19,vars:8,consts:[["content",""],["start",""],["end",""],["dt",""],["header",""],["body",""],["emptymessage",""],[1,"p-dialog-content"],[3,"value"],[1,"p-dialog-footer"],["label","Cancelar","severity","danger","variant","outlined",3,"onClick"],["label","Guardar",3,"onClick","disabled"],["header","Errores Formato",3,"modal","draggable","visible","style","breakpoints"],["mode","asfi-request",3,"isVisible"],[3,"formGroup"],[1,"grid","grid-cols-4","gap-y-8","gap-x-4"],[1,"col-span-2"],["pInputText","","formControlName","requestingAuthority",1,"w-full"],["severity","error","variant","simple","size","small","styleClass","mt-2 px-2"],["pInputText","","formControlName","authorityPosition",1,"w-full"],[1,"w-[220px]","text-xs"],[1,"w-[100px]"],["formControlName","requestCode","mode","decimal",3,"useGrouping","min","max"],[1,"w-[80px]","text-xs"],["optionLabel","label","optionValue","value","placeholder","Tipo proceso","formControlName","processType",1,"w-full",3,"options"],[1,"sm:col-span-2"],["pInputText","","formControlName","department",1,"w-full"],[1,"col-span-4"],[1,"flex","flex-col","sm:flex-row","items-center","gap-4"],["mode","basic","chooseIcon","pi pi-upload","accept",".pdf","auto","","customUpload","","chooseLabel","Seleccionar",3,"onSelect"],[1,"px-3","py-2","rounded-md","bg-green-50","ring-1","ring-green-500","text-black"],[1,"flex","py-4","justify-end"],["icon","pi pi-arrow-right","label","Siguiente","iconPos","right","size","small","severity","secondary",3,"onClick"],[1,"pi","pi-file-pdf"],[1,"ml-2"],[1,"p-0","m-0"],["currentPageReportTemplate","{first} - {last} de {totalRecords} Registros","paginatorDropdownAppendTo","body",3,"value","rows","paginator","showCurrentPageReport","tableStyle","alwaysShowPaginator","globalFilterFields"],[1,"px-4","py-6","font-medium","text-lg"],[1,"flex","py-4","justify-between"],["label","Atras","severity","secondary","size","small","icon","pi pi-arrow-left",3,"onClick"],["severity","danger","label","Remover","icon","pi pi-trash","outlined","",3,"onClick","disabled"],[1,"flex","gap-x-2"],["icon","pi pi-question","pTooltip","Descripcion de datos","tooltipPosition","bottom",3,"onClick"],["severity","secondary","href","files/Formato-Retencion-Suspension.ods","pTooltip","Descargar plantilla","tooltipPosition","bottom",1,"p-button"],[1,"pi","pi-arrow-down"],["mode","basic","accept",".xlsx,.ods","chooseLabel","Importar","auto","","customUpload","",1,"mr-2","inline-block",3,"onSelect","chooseButtonProps"],[3,"min-width"],[1,"flex","items-center"],[3,"colSpan"],["header","Errores Formato",3,"visibleChange","modal","draggable","visible","breakpoints"],["mode","asfi-request",3,"isVisibleChange","isVisible"]],template:function(e,o){if(e&1){let a=x();n(0,"div",7)(1,"p-stepper",8)(2,"p-step-list")(3,"p-step",8),p(4,"Detalle Solicitud"),r(),n(5,"p-step",8),p(6,"Personas Afectadas"),r()(),n(7,"p-step-panels")(8,"p-step-panel",8),h(9,Vt,39,9,"ng-template",null,0,v),r(),n(11,"p-step-panel",8),h(12,zt,9,1,"ng-template",null,0,v),r()()()(),n(14,"div",9)(15,"p-button",10),f("onClick",function(){return u(a),d(o.close())}),r(),n(16,"p-button",11),f("onClick",function(){return u(a),d(o.save())}),r()(),h(17,jt,3,8,"p-dialog",12)(18,Wt,1,1,"data-format-dialog",13)}e&2&&(l(),m("value",1),l(2),m("value",1),l(2),m("value",2),l(3),m("value",1),l(3),m("value",2),l(5),m("disabled",!o.isFormValid),l(),S(o.isErrorDialogShowing()?17:-1),l(),S(o.isInfoDialogShowing()?18:-1))},dependencies:[B,Q,$,Ee,j,W,Y,H,at,rt,We,je,st,lt,nt,ot,Te,qe,Z,K,ft,dt,pt,ut,ct,mt,re,Ke,ze,Ue,Ae,Fe,z,U,ee,X,G,Se,ne,oe,Be,_t,Me,tt],encapsulation:2})};var $t=["op"],Yt=()=>({"min-width":"50rem"});function Ht(t,i){if(t&1){let e=x();n(0,"div",13)(1,"search-input",26),f("onSearch",function(a){u(e);let s=c();return d(s.search(a))}),r()()}}function Jt(t,i){t&1&&(n(0,"tr")(1,"th"),p(2,"Nro. Cite"),r(),n(3,"th"),p(4,"Tipo"),r(),n(5,"th"),p(6,"Circular"),r(),n(7,"th"),p(8,"Fecha Circular"),r(),n(9,"th",27),p(10,"Nota"),r(),n(11,"th"),p(12,"Estado"),r(),g(13,"th",28),r())}function Qt(t,i){if(t&1&&p(0),t&2){let e=c().$implicit;E(" ",e.circularNumber," ")}}function Zt(t,i){t&1&&(n(0,"span",29),p(1,"Sin procesar"),r())}function Kt(t,i){t&1&&g(0,"p-tag",31)}function Xt(t,i){t&1&&g(0,"p-tag",32)}function ei(t,i){t&1&&g(0,"p-tag",33)}function ti(t,i){t&1&&g(0,"p-tag",34)}function ii(t,i){if(t&1){let e=x();n(0,"tr")(1,"td"),p(2),r(),n(3,"td"),p(4),r(),n(5,"td"),h(6,Qt,1,1)(7,Zt,2,0,"span",29),r(),n(8,"td"),p(9),A(10,"date"),r(),n(11,"td")(12,"p-button",30),f("onClick",function(){let a=u(e).$implicit,s=c();return d(s.showFile(a))}),r()(),n(13,"td"),h(14,Kt,1,0,"p-tag",31)(15,Xt,1,0,"p-tag",32)(16,ei,1,0,"p-tag",33)(17,ti,1,0,"p-tag",34),r(),n(18,"td")(19,"p-menu",35,5),f("onShow",function(){let a=u(e).$implicit,s=c();return d(s.onShowOptionsMenu(a))}),r(),n(21,"p-button",36),f("onClick",function(a){u(e);let s=O(20);return d(s.toggle(a))}),r()()()}if(t&2){let e,o=i.$implicit,a=c();l(2),y(o.requestCode),l(2),y(o.processTypeLabel),l(2),S(o.circularNumber?6:7),l(3),E(" ",o.circularDate?V(10,10,o.circularDate,"short"):"Sin fecha"," "),l(3),m("label",o.file.originalName)("link",!0),l(2),S((e=o.status)==="draft"?14:e==="sent"?15:e==="accepted"?16:17),l(5),m("popup",!0)("model",a.menuOptions()),l(2),m("text",!0)}}function oi(t,i){t&1&&(n(0,"tr")(1,"td",37),p(2,"Sin registros"),r()()),t&2&&(l(),m("colSpan",7))}function ni(t,i){if(t&1){let e=x();n(0,"div",13)(1,"p-paginator",38),f("onPageChange",function(a){u(e);let s=c();return d(s.onPageChange(a))}),r()()}if(t&2){let e=c();l(),m("rows",e.limit())("first",e.offset())("totalRecords",e.datasize())("showCurrentPageReport",!0)("showPageLinks",!1)("showJumpToPageDropdown",!1)}}function ri(t,i){if(t&1){let e=x();n(0,"asfi-note-display",39),F("visibleChange",function(a){u(e);let s=c();return T(s.isShowingFile,a)||(s.isShowingFile=a),d(a)}),r()}if(t&2){let e=c();m("url",e.selectedItem().file.fileName),q("visible",e.isShowingFile)}}var le=class t{asfiRequestService=C(te);dialogService=C(Re);formBuilder=C(J);fileService=C(ie);popoverRef=ue.required("op");datasource=_([]);datasize=_(0);limit=_(10);index=_(0);offset=he(()=>this.limit()*this.index());term=_("");isShowingFile=_(!1);selectedItem=_(null);menuOptions=_([]);PROCESS_TYPES=[{value:"R",label:"Retencion"},{value:"S",label:"Suspension"}];STATUS=[{value:"accepted",label:"Procesado"},{value:"draft",label:"Registrado"},{value:"rejected",label:"Rechazado"},{value:"sent",label:"Enviado"}];filterForm=this.formBuilder.group({createdAt:[""],processType:[""],status:[""]});ngOnInit(){this.getData()}search(i){this.term.set(i),this.index.set(0),this.getData()}filter(){this.index.set(0),this.popoverRef().hide(),this.getData()}resetFilter(){this.filterForm.reset(),this.filter()}onPageChange({rows:i=10,page:e=0}){this.limit.set(i),this.index.set(e),this.getData()}create(){this.dialogService.open(M,{header:"Crear Solicitud",maximizable:!0,modal:!0,width:"50vw",breakpoints:{"960px":"75vw","640px":"90vw"}}).onClose.subscribe(e=>{e&&(this.datasource.update(o=>[e,...o].slice(0,this.limit())),this.datasize.update(o=>o+=1))})}update(i){this.dialogService.open(M,{header:"Editar Solicitud",maximizable:!0,modal:!0,width:"50vw",breakpoints:{"960px":"75vw","640px":"90vw"},data:i}).onClose.subscribe(o=>{o&&this.datasource.update(a=>{let s=a.findIndex(({id:w})=>w===o.id);return s===-1?a:(a[s]=o,[...a])})})}showDetail(i){let e={requestId:i.requestId,requestCode:i.requestCode,processType:i.processType,createdAt:i.createdAt};this.dialogService.open(it,{header:"Detalle Solicitud",data:e,modal:!0,width:"50vw",focusOnShow:!1,closable:!0,breakpoints:{"960px":"75vw","640px":"90vw"}})}showFile(i){this.selectedItem.set(i),this.isShowingFile.set(!0)}onShowOptionsMenu(i){this.menuOptions.set([{label:"Opciones",items:[{icon:"pi pi-pencil",label:"Editar solicitud",disabled:i.status==="draft"||i.status==="rejected",command:()=>{this.update(i)}},{icon:"pi pi-info-circle",label:"Detalle solicitud",command:()=>{this.showDetail(i)}},{icon:"pi pi-download",label:"Descargar datos",command:()=>{this.downloadFile(i)}}]}])}get isFilterFormValid(){return Object.values(this.filterForm.value).some(i=>i)}getData(){this.asfiRequestService.getRequests(D({limit:this.limit(),offset:this.offset(),term:this.term()},this.filterForm.value)).subscribe(i=>{this.datasource.set(i.requests),this.datasize.set(i.length)})}downloadFile(i){let e=i.dataSheetFile.split(".").pop(),o=`solicitud_${i.processTypeLabel}_${i.requestCode}.${e}`.toLocaleLowerCase();this.fileService.downloadFileFromUrl(i.dataSheetFile,o)}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=I({type:t,selectors:[["app-asfi-request"]],viewQuery:function(e,o){e&1&&_e(o.popoverRef,$t,5),e&2&&ge()},decls:36,vars:12,consts:[["caption",""],["header",""],["body",""],["emptymessage",""],["op",""],["menu",""],[1,"flex","items-center","justify-between"],[1,"font-medium","text-2xl"],[1,"flex","gap-x-4"],["icon","pi pi-filter",3,"click"],["label","Agregar","icon","pi pi-plus",3,"onClick"],[1,"card","mt-4"],[3,"value","tableStyle"],[1,"flex","justify-end"],[3,"url","visible"],[1,"flex","flex-col","gap-4","w-[25rem]","p-2"],[1,"text-xl"],["icon","pi pi-times",3,"onClick","text"],[3,"formGroup"],[1,"mt-4","flex","flex-col","gap-y-4"],["optionLabel","label","placeholder","Tipo de solicitud","optionValue","value","formControlName","processType",1,"w-full",3,"options"],["optionLabel","label","placeholder","Estado del envio","optionValue","value","formControlName","status",1,"w-full",3,"options"],["inputId","icondisplay","styleClass","w-full","placeholder","Fecha creacion","optionValue","value","formControlName","createdAt",1,"w-full",3,"iconDisplay","showIcon"],[1,"flex","justify-end","gap-x-2","mt-4"],["label","Limpiar","severity","secondary",3,"onClick"],["label","Filtrar",3,"onClick","disabled"],["placeholder","Buscar",3,"onSearch"],[2,"width","25%"],[2,"width","4rem"],[1,"text-red-500"],["icon","pi pi-file-pdf","size","small","styleClass","truncate max-w-[350px]",3,"onClick","label","link"],["severity","warn","value","Registrado"],["severity","info","value","Enviado"],["severity","success","value","Procesado"],["severity","danger","value","Rechazado"],["appendTo","body",3,"onShow","popup","model"],["size","small","icon","pi pi-ellipsis-v",3,"onClick","text"],[3,"colSpan"],["currentPageReportTemplate","{first} - {last} de {totalRecords} Registros",3,"onPageChange","rows","first","totalRecords","showCurrentPageReport","showPageLinks","showJumpToPageDropdown"],[3,"visibleChange","url","visible"]],template:function(e,o){if(e&1){let a=x();n(0,"div",6)(1,"span",7),p(2,"Retenciones / Suspensiones"),r(),n(3,"div",8)(4,"p-button",9),f("click",function(w){u(a);let gt=O(19);return d(gt.toggle(w))}),r(),n(5,"p-button",10),f("onClick",function(){return u(a),d(o.create())}),r()()(),n(6,"div",11)(7,"p-table",12),h(8,Ht,2,0,"ng-template",null,0,v)(10,Jt,14,0,"ng-template",null,1,v)(12,ii,22,13,"ng-template",null,2,v)(14,oi,3,1,"ng-template",null,3,v),r(),h(16,ni,2,6,"div",13),r(),h(17,ri,1,2,"asfi-note-display",14),n(18,"p-popover",null,4)(20,"div",15)(21,"div",6)(22,"div",16),p(23,"Filtro avanzado"),r(),n(24,"p-button",17),f("onClick",function(){u(a);let w=O(19);return d(w.hide())}),r()(),n(25,"form",18)(26,"div",19)(27,"div"),g(28,"p-select",20),r(),n(29,"div"),g(30,"p-select",21),r(),n(31,"div"),g(32,"p-datepicker",22),r()()(),n(33,"div",23)(34,"p-button",24),f("onClick",function(){return u(a),d(o.resetFilter())}),r(),n(35,"p-button",25),f("onClick",function(){return u(a),d(o.filter())}),r()()()()}e&2&&(l(7),m("value",o.datasource())("tableStyle",R(11,Yt)),l(9),S(o.datasize()>o.limit()?16:-1),l(),S(o.isShowingFile()?17:-1),l(7),m("text",!0),l(),m("formGroup",o.filterForm),l(3),m("options",o.PROCESS_TYPES),l(2),m("options",o.STATUS),l(2),m("iconDisplay","input")("showIcon",!0),l(3),m("disabled",!o.isFilterFormValid))},dependencies:[B,Ce,Q,$,j,W,Y,H,ye,Je,He,Xe,Ye,$e,K,Z,re,G,z,U,ne,oe,Ze,Qe,Le,Pe,ke,Ie,ee,X,Ve,et],encapsulation:2,changeDetection:0})};export{le as default};
